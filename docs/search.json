[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Microbiome Data Visualization",
    "section": "",
    "text": "Free Guide · Updated Feb 2026",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>index.html</span>"
    ]
  },
  {
    "objectID": "01-preface.html",
    "href": "01-preface.html",
    "title": "Preface",
    "section": "",
    "text": "Welcome\nMicrobiome studies frequently present:\nThese figures are familiar.\nInterpreting them correctly is less common.\nA plot can look structured and convincing. That does not automatically make it biologically meaningful.\nThis guide provides a structured pathway from raw feature tables to careful, defensible visual interpretation.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "01-preface.html#welcome",
    "href": "01-preface.html#welcome",
    "title": "Preface",
    "section": "",
    "text": "composition bar plots\n\nalpha diversity summaries\n\nordination maps\n\nheatmaps and clustering patterns",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "01-preface.html#what-this-guide-does",
    "href": "01-preface.html#what-this-guide-does",
    "title": "Preface",
    "section": "What This Guide Does",
    "text": "What This Guide Does\nThis is a structured, applied guide to microbiome data visualization using R.\nWe begin with a validated phyloseq object derived from publicly available QIIME2 outputs and build forward from there.\nThe emphasis is not on generating every possible figure. It is on understanding:\n\nwhat each visualization encodes\n\nhow preprocessing decisions shape what you see\n\nhow filtering alters apparent patterns\n\nhow compositional constraints affect interpretation\n\nClarity in microbiome analysis begins with structural awareness.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "01-preface.html#how-this-guide-is-organized",
    "href": "01-preface.html#how-this-guide-is-organized",
    "title": "Preface",
    "section": "How This Guide Is Organized",
    "text": "How This Guide Is Organized\nThe chapters follow a logical progression:\n\nDatasets\nUnderstanding the internal structure of the phyloseq object\nData Structure and Prevalence\nSparsity, sequencing depth variation, and filtering logic\nComposition Visualization\nRelative abundance, aggregation choices, and compositional limits\nDiversity Analysis\nWhat alpha diversity measures — and what it does not\nOrdination Plots\nWhat visual separation implies — and what it does not\nHeatmaps and Patterns\nRecognizing structure without over-claiming\nSummary and Next Steps\nExtending analysis responsibly\n\nEach chapter combines reproducible code with interpretive framing.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "01-preface.html#who-this-guide-is-for",
    "href": "01-preface.html#who-this-guide-is-for",
    "title": "Preface",
    "section": "Who This Guide Is For",
    "text": "Who This Guide Is For\nThis guide is written for:\n\nResearchers working with 16S microbiome outputs from QIIME2, mothur, or similar pipelines\n\nLearners comfortable running R code who want stronger interpretive reasoning\n\nAnalysts preparing figures for manuscripts, theses, or reports\n\nNo advanced statistics are required.\nWhat is required is careful thinking.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "01-preface.html#relationship-to-imap",
    "href": "01-preface.html#relationship-to-imap",
    "title": "Preface",
    "section": "Relationship to iMAP",
    "text": "Relationship to iMAP\nThe iMAP repositories provide modular steps for microbiome data processing and exploratory workflows.\nThis guide does not replace those pipelines.\nIt begins after feature tables and taxonomy have been generated.\nIt strengthens the interpretive layer by connecting visualization choices to the questions they are intended to answer.\nTogether, iMAP and this guide form a coherent path from sequencing output to biological insight.\n\n\nA figure is not a conclusion.\nInterpretation requires understanding structure before pattern.",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Preface</span>"
    ]
  },
  {
    "objectID": "02-datasets.html",
    "href": "02-datasets.html",
    "title": "Datasets",
    "section": "",
    "text": "Load the canonical object\nThis guide uses the QIIME2 Moving Pictures demo dataset.\nThe data are downloaded as QIIME2 artifacts and converted into a single phyloseq object using reproducible scripts:\nThose scripts:\nFrom this point onward, we work with one structured object.\nlibrary(phyloseq)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "02-datasets.html#load-the-canonical-object",
    "href": "02-datasets.html#load-the-canonical-object",
    "title": "Datasets",
    "section": "",
    "text": "A microbiome dataset is not a single table.\nIt is a coordinated structure containing: - an abundance matrix\n- sample-level metadata\n- taxonomic annotation\nAll components must align exactly.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "02-datasets.html#inspect-the-otu-table",
    "href": "02-datasets.html#inspect-the-otu-table",
    "title": "Datasets",
    "section": "Inspect the OTU table",
    "text": "Inspect the OTU table\n\notu &lt;- methods::as(phyloseq::otu_table(ps), \"matrix\")\n\nif (!phyloseq::taxa_are_rows(ps)) {\n  otu &lt;- t(otu)\n}\n\notu[1:6, 1:6]\n\n                                 L1S105 L1S140 L1S208 L1S257 L1S281 L1S57\n33e2cadd9d0b2b4ebeb6261766032e4a      0      0      0      0      0     0\n5656d8b980bfee07e29e8fc119850901      0      0      0      0      0     0\n7d893311a14a858907d4c8ca21d32dc4      0      0      0      0      0     0\necf9eb9fa3970ff27a221e626395c75d      0      0      0      0      0     0\nacfe4c003905a7074aeaf385b78ad9e0      0      0    104     50     47     0\n80b20e907aa4fcf2309796bc303d151d      0     48      0     11      0     0\n\n\n\nThis is a small slice of the count matrix.\n\nRows represent taxa (ASVs)\n\nColumns represent samples\n\nValues are raw read counts\n\nMost entries are zero.\nSparsity is not a technical artifact. It is a biological reality.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "02-datasets.html#inspect-sample-metadata",
    "href": "02-datasets.html#inspect-sample-metadata",
    "title": "Datasets",
    "section": "Inspect sample metadata",
    "text": "Inspect sample metadata\n\nhead(phyloseq::sample_data(ps))\n\n       barcode.sequence body.site year month day   subject\nL1S105     AGTGCGATGCGT       gut 2009     3  17 subject-1\nL1S140     ATGGCAGCTCTA       gut 2008    10  28 subject-2\nL1S208     CTGAGATACGCG       gut 2009     1  20 subject-2\nL1S257     CCGACTGAGATG       gut 2009     3  17 subject-2\nL1S281     CCTCTCGTGATC       gut 2009     4  14 subject-2\nL1S57      ACACACTATGGC       gut 2009     1  20 subject-1\n       reported.antibiotic.usage days.since.experiment.start\nL1S105                        No                         140\nL1S140                       Yes                           0\nL1S208                        No                          84\nL1S257                        No                         140\nL1S281                        No                         168\nL1S57                         No                          84\n\n\n\nMetadata provides the biological and experimental context.\nWithout metadata, abundance values have no meaning. Visualization is always performed relative to metadata.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "02-datasets.html#inspect-taxonomy",
    "href": "02-datasets.html#inspect-taxonomy",
    "title": "Datasets",
    "section": "Inspect taxonomy",
    "text": "Inspect taxonomy\n\nhead(phyloseq::tax_table(ps))\n\nTaxonomy Table:     [6 taxa by 7 taxonomic ranks]:\n                                 Kingdom    Phylum          \n33e2cadd9d0b2b4ebeb6261766032e4a \"Bacteria\" \"Firmicutes\"    \n5656d8b980bfee07e29e8fc119850901 \"Bacteria\" \"Firmicutes\"    \n7d893311a14a858907d4c8ca21d32dc4 \"Bacteria\" \"Firmicutes\"    \necf9eb9fa3970ff27a221e626395c75d \"Bacteria\" \"Proteobacteria\"\nacfe4c003905a7074aeaf385b78ad9e0 \"Bacteria\" \"Firmicutes\"    \n80b20e907aa4fcf2309796bc303d151d \"Bacteria\" \"Firmicutes\"    \n                                 Class                 Order          \n33e2cadd9d0b2b4ebeb6261766032e4a \"Clostridia\"          \"Clostridiales\"\n5656d8b980bfee07e29e8fc119850901 \"Clostridia\"          \"Clostridiales\"\n7d893311a14a858907d4c8ca21d32dc4 \"Clostridia\"          \"Clostridiales\"\necf9eb9fa3970ff27a221e626395c75d \"Alphaproteobacteria\" \"Rickettsiales\"\nacfe4c003905a7074aeaf385b78ad9e0 \"Clostridia\"          \"Clostridiales\"\n80b20e907aa4fcf2309796bc303d151d \"Clostridia\"          \"Clostridiales\"\n                                 Family            Genus         Species     \n33e2cadd9d0b2b4ebeb6261766032e4a \"Peptococcaceae\"  \"Peptococcus\" NA          \n5656d8b980bfee07e29e8fc119850901 \"Peptococcaceae\"  \"Peptococcus\" NA          \n7d893311a14a858907d4c8ca21d32dc4 \"Peptococcaceae\"  \"Peptococcus\" NA          \necf9eb9fa3970ff27a221e626395c75d \"mitochondria\"    \"Raphanus\"    \"sativus\"   \nacfe4c003905a7074aeaf385b78ad9e0 \"Ruminococcaceae\" \"Gemmiger\"    \"formicilis\"\n80b20e907aa4fcf2309796bc303d151d \"Ruminococcaceae\" NA            NA          \n\n\n\nTaxonomy links sequence variants to biological hierarchy.\nAggregation (for example genus-level barplots) depends entirely on this mapping. If taxonomy is inconsistent, interpretation becomes unstable.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "02-datasets.html#structural-integrity",
    "href": "02-datasets.html#structural-integrity",
    "title": "Datasets",
    "section": "Structural integrity",
    "text": "Structural integrity\n\nall(phyloseq::sample_names(ps) == \n    rownames(phyloseq::sample_data(ps)))\n\n[1] TRUE\n\n\n\nA valid phyloseq object guarantees alignment across components.\nMany downstream errors originate from mismatched sample identifiers.",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Datasets</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html",
    "href": "03-data-structure-and-prevalence.html",
    "title": "Data Structure and Prevalence",
    "section": "",
    "text": "Data structure and prevalence\nMicrobiome count data is structurally sparse and uneven.\nThis chapter focuses on:",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#load-data",
    "href": "03-data-structure-and-prevalence.html#load-data",
    "title": "Data Structure and Prevalence",
    "section": "Load data",
    "text": "Load data\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#sparsity",
    "href": "03-data-structure-and-prevalence.html#sparsity",
    "title": "Data Structure and Prevalence",
    "section": "Sparsity",
    "text": "Sparsity\n\notu &lt;- methods::as(phyloseq::otu_table(ps), \"matrix\")\nif (!phyloseq::taxa_are_rows(ps)) {\n  otu &lt;- t(otu)\n}\n\nzero_prop &lt;- mean(otu == 0)\nzero_prop\n\n[1] 0.9111154\n\n\n\nA high proportion of zeros is normal in microbiome data.\nFiltering decisions are not cosmetic. They determine which patterns become visible.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#library-size-variation",
    "href": "03-data-structure-and-prevalence.html#library-size-variation",
    "title": "Data Structure and Prevalence",
    "section": "Library size variation",
    "text": "Library size variation\n\nlib_size &lt;- phyloseq::sample_sums(ps)\nsummary(lib_size)\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n    897    1838    4010    4524    7013    9820 \n\ndf_lib &lt;- data.frame(\n  sample_id = names(lib_size),\n  library_size = as.numeric(lib_size),\n  stringsAsFactors = FALSE\n)\n\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nreadr::write_csv(df_lib, \"outputs/tables/library-size.csv\")\n\n\nLibrary size distribution (Python)\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/library-size.csv\")\n\nfig, ax = plt.subplots(figsize=(8, 5))\nax.hist(df[\"library_size\"], bins=25, edgecolor=\"white\", linewidth=0.8)\n\nax.set_title(\"Library size distribution\")\nax.set_xlabel(\"Library size (total reads per sample)\")\nax.set_ylabel(\"Number of samples\")\n\nax.grid(True, axis=\"y\", alpha=0.25)\nax.spines[\"top\"].set_visible(False)\nax.spines[\"right\"].set_visible(False)\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nWhen sequencing depth varies, raw counts are not comparable.\nNormalization is required for fair comparison across samples.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#detection-and-prevalence",
    "href": "03-data-structure-and-prevalence.html#detection-and-prevalence",
    "title": "Data Structure and Prevalence",
    "section": "Detection and prevalence",
    "text": "Detection and prevalence\n\ndetection &lt;- 1\n\ntaxa_prev_n &lt;- rowSums(otu &gt;= detection)\ntaxa_prev_df &lt;- data.frame(\n  taxon = rownames(otu),\n  prevalence_n = taxa_prev_n,\n  prevalence_frac = taxa_prev_n / ncol(otu),\n  stringsAsFactors = FALSE\n)\n\nsummary(taxa_prev_df$prevalence_n)\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n  1.000   1.000   2.000   3.022   4.000  26.000 \n\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nreadr::write_csv(taxa_prev_df, \"outputs/tables/taxa-prevalence.csv\")\n\n\nPrevalence distribution (Python)\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/taxa-prevalence.csv\")\n\nfig, ax = plt.subplots(figsize=(8, 5))\nax.hist(df[\"prevalence_n\"], bins=25, edgecolor=\"white\", linewidth=0.8)\n\nax.set_title(\"Taxon prevalence distribution\")\nax.set_xlabel(\"Number of samples detected\")\nax.set_ylabel(\"Number of taxa\")\n\nax.grid(True, axis=\"y\", alpha=0.25)\nax.spines[\"top\"].set_visible(False)\nax.spines[\"right\"].set_visible(False)\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n# Optional: ECDF view (often clearer for sparse data)\nx = np.sort(df[\"prevalence_n\"].to_numpy())\ny = np.arange(1, len(x) + 1) / len(x)\n\nfig, ax = plt.subplots(figsize=(8, 5))\nax.plot(x, y)\nax.set_title(\"ECDF of taxon prevalence\")\nax.set_xlabel(\"Number of samples detected\")\nax.set_ylabel(\"Fraction of taxa\")\n\nax.grid(True, alpha=0.25)\nax.spines[\"top\"].set_visible(False)\nax.spines[\"right\"].set_visible(False)\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nMost taxa are observed in only a small fraction of samples.\nPrevalence filtering improves clarity, but it also changes the feature space. Filtering rules must be stated explicitly.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#simple-prevalence-filter",
    "href": "03-data-structure-and-prevalence.html#simple-prevalence-filter",
    "title": "Data Structure and Prevalence",
    "section": "Simple prevalence filter",
    "text": "Simple prevalence filter\n\nmin_prev_frac &lt;- 0.10\n\nkeep_taxa &lt;- taxa_prev_df$taxon[taxa_prev_df$prevalence_frac &gt;= min_prev_frac]\nps_prev &lt;- phyloseq::prune_taxa(keep_taxa, ps)\n\nc(original_taxa = phyloseq::ntaxa(ps), after_filter = phyloseq::ntaxa(ps_prev))\n\noriginal_taxa  after_filter \n          770           204 \n\n\n\nPrevalence filtering reduces dimensionality and improves readability.\nIt can also change ordination and diversity results. Interpretation should acknowledge these choices.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "03-data-structure-and-prevalence.html#relative-abundance-preview",
    "href": "03-data-structure-and-prevalence.html#relative-abundance-preview",
    "title": "Data Structure and Prevalence",
    "section": "Relative abundance preview",
    "text": "Relative abundance preview\n\nps_rel &lt;- phyloseq::transform_sample_counts(ps, function(x) x / sum(x))\nrange(phyloseq::sample_sums(ps_rel))\n\n[1] 1 1\n\n\n\nAfter transformation, each sample sums to 1.\nThis enables clearer visualization, but does not remove compositional constraints.",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Data Structure and Prevalence</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html",
    "href": "04-composition-visualization.html",
    "title": "Composition Visualization",
    "section": "",
    "text": "Composition Visualization\nComposition plots are often the first figures shown in microbiome studies.\nBar plots at the phylum or genus level are common. They appear intuitive. They are also easy to misinterpret.\nThis chapter focuses on:",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#load-data",
    "href": "04-composition-visualization.html#load-data",
    "title": "Composition Visualization",
    "section": "Load data",
    "text": "Load data\n\nlibrary(phyloseq)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#transform-to-relative-abundance",
    "href": "04-composition-visualization.html#transform-to-relative-abundance",
    "title": "Composition Visualization",
    "section": "Transform to relative abundance",
    "text": "Transform to relative abundance\nRaw counts are not comparable across samples with different sequencing depth.\n\nps_rel &lt;- phyloseq::transform_sample_counts(ps, function(x) x / sum(x))\nrange(phyloseq::sample_sums(ps_rel))\n\n[1] 1 1\n\n\n\nEach sample now sums to 1.\nThis enables proportional comparison across samples. However, relative abundance introduces compositional constraints. An increase in one taxon must decrease another.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#aggregate-to-genus-level",
    "href": "04-composition-visualization.html#aggregate-to-genus-level",
    "title": "Composition Visualization",
    "section": "Aggregate to genus level",
    "text": "Aggregate to genus level\n\nps_genus &lt;- phyloseq::tax_glom(ps_rel, taxrank = \"Genus\")\nphyloseq::ntaxa(ps_genus)\n\n[1] 197\n\n\nRemove taxa without genus assignment:\n\nps_genus &lt;- phyloseq::subset_taxa(ps_genus, !is.na(Genus))\nphyloseq::ntaxa(ps_genus)\n\n[1] 197\n\n\n\nAggregation simplifies visualization, but it also hides within-genus variation.\nResolution is always a trade-off.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#identify-top-genera",
    "href": "04-composition-visualization.html#identify-top-genera",
    "title": "Composition Visualization",
    "section": "Identify top genera",
    "text": "Identify top genera\nTo improve readability, select the globally most abundant genera.\n\ngenus_abundance &lt;- phyloseq::taxa_sums(ps_genus)\ntop_genera &lt;- names(sort(genus_abundance, decreasing = TRUE))[1:10]\n\nps_top &lt;- phyloseq::prune_taxa(top_genera, ps_genus)\nphyloseq::ntaxa(ps_top)\n\n[1] 10",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#prepare-composition-table-for-plotting",
    "href": "04-composition-visualization.html#prepare-composition-table-for-plotting",
    "title": "Composition Visualization",
    "section": "Prepare composition table for plotting",
    "text": "Prepare composition table for plotting\nWe will compute mean relative abundance by body site, then show two modern Python visualizations: a stacked bar chart and a heatmap.\n\n# Long format table (sample-level)\ndf_comp &lt;- phyloseq::psmelt(ps_top)\n\n# Detect column names robustly (psmelt can vary by dataset)\ncols &lt;- names(df_comp)\n\nsample_col &lt;- if (\"Sample\" %in% cols) \"Sample\" else if (\"SampleID\" %in% cols) \"SampleID\" else if (\"sample_id\" %in% cols) \"sample_id\" else NA_character_\nbody_col   &lt;- if (\"body-site\" %in% cols) \"body-site\" else if (\"body.site\" %in% cols) \"body.site\" else if (\"body_site\" %in% cols) \"body_site\" else NA_character_\n\nif (is.na(sample_col) || is.na(body_col)) {\n  stop(\n    \"Expected columns not found in psmelt output.\n\",\n    \"Available columns: \", paste(cols, collapse = \", \"), \"\n\",\n    \"Missing: \",\n    paste(c(if (is.na(sample_col)) \"Sample/SampleID\" else NULL,\n            if (is.na(body_col)) \"body-site/body.site/body_site\" else NULL),\n          collapse = \", \")\n  )\n}\n\n# Keep only what we need and standardize names\ndf_comp &lt;- df_comp[, c(sample_col, \"Abundance\", \"Genus\", body_col)]\nnames(df_comp) &lt;- c(\"Sample\", \"Abundance\", \"Genus\", \"body_site\")\n\n# Mean relative abundance by (body_site, Genus)\ndf_mean &lt;- aggregate(\n  Abundance ~ body_site + Genus,\n  data = df_comp,\n  FUN = mean\n)\n\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nreadr::write_csv(df_mean, \"outputs/tables/mean-composition-body-site-genus.csv\")\n\nhead(df_mean)\n\n   body_site           Genus    Abundance\n1        gut     Bacteroides 0.5623933731\n2  left palm     Bacteroides 0.0074999258\n3 right palm     Bacteroides 0.1497196754\n4     tongue     Bacteroides 0.0023039649\n5        gut Corynebacterium 0.0001221555\n6  left palm Corynebacterium 0.1273285793\n\n\n\nFor overview plots, averaging within a group can reveal stable patterns that are hard to see at the sample level.\nThis is descriptive summarization, not inference.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#composition-by-body-site-python-stacked-bar",
    "href": "04-composition-visualization.html#composition-by-body-site-python-stacked-bar",
    "title": "Composition Visualization",
    "section": "Composition by body site (Python stacked bar)",
    "text": "Composition by body site (Python stacked bar)\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/mean-composition-body-site-genus.csv\")\n\n# Pivot to body-site x genus\nwide = df.pivot(index=\"body_site\", columns=\"Genus\", values=\"Abundance\").fillna(0)\n\n# Ensure consistent order (largest total first)\nwide = wide.loc[wide.sum(axis=1).sort_values(ascending=False).index]\n\nfig, ax = plt.subplots(figsize=(9, 5))\n\nbottom = None\nfor col in wide.columns:\n    vals = wide[col].to_numpy()\n    if bottom is None:\n        ax.bar(wide.index, vals, label=col)\n        bottom = vals\n    else:\n        ax.bar(wide.index, vals, bottom=bottom, label=col)\n        bottom = bottom + vals\n\nax.set_title(\"Mean genus composition by body site\")\nax.set_xlabel(\"Body site\")\nax.set_ylabel(\"Mean relative abundance\")\n\nax.grid(True, axis=\"y\", alpha=0.25)\nax.spines[\"top\"].set_visible(False)\nax.spines[\"right\"].set_visible(False)\n\n# Legend outside for readability\nax.legend(title=\"Genus\", bbox_to_anchor=(1.02, 1), loc=\"upper left\", frameon=False)\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nThese bars show average proportions, not absolute microbial load.\nA taxon can appear to “increase” in relative abundance even if its absolute abundance is unchanged.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#composition-heatmap-python",
    "href": "04-composition-visualization.html#composition-heatmap-python",
    "title": "Composition Visualization",
    "section": "Composition heatmap (Python)",
    "text": "Composition heatmap (Python)\n\nimport pandas as pd\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/mean-composition-body-site-genus.csv\")\nwide = df.pivot(index=\"body_site\", columns=\"Genus\", values=\"Abundance\").fillna(0)\n\n# Order rows and columns by overall abundance\nwide = wide.loc[wide.sum(axis=1).sort_values(ascending=False).index]\nwide = wide[wide.sum(axis=0).sort_values(ascending=False).index]\n\nfig, ax = plt.subplots(figsize=(9, 5))\nim = ax.imshow(wide.values, aspect=\"auto\")\n\nax.set_title(\"Heatmap of mean genus composition\")\nax.set_xlabel(\"Genus\")\nax.set_ylabel(\"Body site\")\n\nax.set_yticks(range(len(wide.index)))\nax.set_yticklabels(list(wide.index))\n\nax.set_xticks(range(len(wide.columns)))\nax.set_xticklabels(list(wide.columns), rotation=45, ha=\"right\")\n\ncbar = fig.colorbar(im, ax=ax)\ncbar.set_label(\"Mean relative abundance\")\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nHeatmaps emphasize patterns of dominance and absence across groups.\nThey are sensitive to aggregation level and filtering choices.",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "04-composition-visualization.html#limitations-of-composition-plots",
    "href": "04-composition-visualization.html#limitations-of-composition-plots",
    "title": "Composition Visualization",
    "section": "Limitations of composition plots",
    "text": "Limitations of composition plots\nComposition plots:\n\nare constrained by constant-sum scaling\ncannot reveal absolute abundance changes\nare sensitive to filtering and aggregation level\n\n\nComposition plots answer: “What proportion of the community does each taxon occupy?”\nThey do not answer: “Did the taxon increase in absolute abundance?”",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Composition Visualization</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html",
    "href": "05-diversity-analysis.html",
    "title": "Diversity Analysis",
    "section": "",
    "text": "Diversity Analysis\nAlpha diversity summaries are common in microbiome studies.\nThey are useful — but only when interpreted carefully.\nThis chapter focuses on:",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#load-data",
    "href": "05-diversity-analysis.html#load-data",
    "title": "Diversity Analysis",
    "section": "Load Data",
    "text": "Load Data\n\nlibrary(phyloseq)\nlibrary(vegan)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#check-sequencing-depth-r-python",
    "href": "05-diversity-analysis.html#check-sequencing-depth-r-python",
    "title": "Diversity Analysis",
    "section": "Check Sequencing Depth (R → Python)",
    "text": "Check Sequencing Depth (R → Python)\nAlpha diversity is sensitive to sequencing depth.\n\nlib_size &lt;- phyloseq::sample_sums(ps)\n\ndf_lib &lt;- data.frame(\n  sample_id = names(lib_size),\n  library_size = as.numeric(lib_size),\n  stringsAsFactors = FALSE\n)\n\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nreadr::write_csv(df_lib, \"outputs/tables/library-size.csv\")\n\nsummary(df_lib$library_size)\n\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n    897    1838    4010    4524    7013    9820 \n\n\n\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/library-size.csv\")\n\nsns.set_theme(style=\"whitegrid\")\n\nplt.figure(figsize=(9,5))\nsns.histplot(df[\"library_size\"], bins=30, kde=True)\n\nplt.title(\"Sequencing depth distribution\")\nplt.xlabel(\"Library size (total reads per sample)\")\nplt.ylabel(\"Number of samples\")\n\nsns.despine()\nplt.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nIf sequencing depth varies widely, observed richness may vary even if communities are identical.\nDepth inspection is part of interpretation, not an optional diagnostic.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#compute-alpha-diversity-r",
    "href": "05-diversity-analysis.html#compute-alpha-diversity-r",
    "title": "Diversity Analysis",
    "section": "Compute Alpha Diversity (R)",
    "text": "Compute Alpha Diversity (R)\n\notu &lt;- methods::as(phyloseq::otu_table(ps), \"matrix\")\nif (!phyloseq::taxa_are_rows(ps)) otu &lt;- t(otu)\n\nobserved &lt;- colSums(otu &gt; 0)\nshannon  &lt;- vegan::diversity(t(otu), index = \"shannon\")\nsimpson  &lt;- vegan::diversity(t(otu), index = \"simpson\")\npielou   &lt;- shannon / log(pmax(observed, 1))\n\nalpha_df &lt;- data.frame(\n  sample_id = colnames(otu),\n  observed  = observed,\n  shannon   = shannon,\n  simpson   = simpson,\n  pielou    = pielou,\n  stringsAsFactors = FALSE\n)\n\nmeta &lt;- data.frame(phyloseq::sample_data(ps))\nmeta$sample_id &lt;- rownames(meta)\n\nalpha_df &lt;- merge(alpha_df, meta, by = \"sample_id\", all.x = TRUE)\n\ncols &lt;- names(alpha_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\n\nif (length(body_col) == 0) {\n  stop(\n    \"Body site column not found. Available columns: \",\n    paste(cols, collapse = \", \")\n  )\n}\n\nalpha_df$body_site &lt;- alpha_df[[body_col[1]]]\nalpha_df$library_size &lt;- phyloseq::sample_sums(ps)[alpha_df$sample_id]\n\nreadr::write_csv(alpha_df, \"outputs/tables/alpha-diversity.csv\")\n\nhead(alpha_df)\n\n  sample_id observed  shannon   simpson    pielou barcode.sequence body.site\n1    L1S105       63 2.682108 0.8707597 0.6473620     AGTGCGATGCGT       gut\n2    L1S140       65 2.660947 0.8518507 0.6374460     ATGGCAGCTCTA       gut\n3    L1S208       85 3.121034 0.8999369 0.7025161     CTGAGATACGCG       gut\n4    L1S257       81 3.262504 0.9261295 0.7424147     CCGACTGAGATG       gut\n5    L1S281       72 3.189387 0.9082814 0.7457648     CCTCTCGTGATC       gut\n6     L1S57       70 2.905920 0.8661380 0.6839881     ACACACTATGGC       gut\n  year month day   subject reported.antibiotic.usage\n1 2009     3  17 subject-1                        No\n2 2008    10  28 subject-2                       Yes\n3 2009     1  20 subject-2                        No\n4 2009     3  17 subject-2                        No\n5 2009     4  14 subject-2                        No\n6 2009     1  20 subject-1                        No\n  days.since.experiment.start body_site library_size\n1                         140       gut         7780\n2                           0       gut         7163\n3                          84       gut         8152\n4                         140       gut         6388\n5                         168       gut         6615\n6                          84       gut         8702",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#visualize-alpha-diversity-python-seaborn",
    "href": "05-diversity-analysis.html#visualize-alpha-diversity-python-seaborn",
    "title": "Diversity Analysis",
    "section": "Visualize Alpha Diversity (Python, Seaborn)",
    "text": "Visualize Alpha Diversity (Python, Seaborn)\n\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\ndf = pd.read_csv(\"outputs/tables/alpha-diversity.csv\")\ndf = df.dropna(subset=[\"body_site\"])\n\nsns.set_theme(style=\"whitegrid\")\n\nmetrics = [\n    (\"observed\", \"Observed richness\"),\n    (\"shannon\", \"Shannon diversity\"),\n    (\"simpson\", \"Simpson diversity\"),\n    (\"pielou\", \"Pielou evenness\"),\n]\n\norder = (\n    df.groupby(\"body_site\")[\"observed\"]\n    .median()\n    .sort_values(ascending=False)\n    .index\n)\n\nfor col, title in metrics:\n    fig, ax = plt.subplots(figsize=(9,5))\n\n    sns.boxplot(\n        data=df,\n        x=\"body_site\",\n        y=col,\n        order=order,\n        showfliers=False,\n        width=0.6,\n        ax=ax\n    )\n\n    sns.stripplot(\n        data=df,\n        x=\"body_site\",\n        y=col,\n        order=order,\n        size=3,\n        alpha=0.4,\n        jitter=0.25,\n        ax=ax\n    )\n\n    ax.set_title(f\"{title} by body site\")\n    ax.set_xlabel(\"Body site\")\n    ax.set_ylabel(title)\n\n    sns.despine()\n    plt.setp(ax.get_xticklabels(), rotation=20, ha=\"right\")\n\n    fig.tight_layout()\n    plt.show()\n\n&lt;Axes: xlabel='body_site', ylabel='observed'&gt;\n&lt;Axes: xlabel='body_site', ylabel='observed'&gt;\nText(0.5, 1.0, 'Observed richness by body site')\nText(0.5, 0, 'Body site')\nText(0, 0.5, 'Observed richness')\n[None, None, None, None, None, None, None, None]\n&lt;Axes: xlabel='body_site', ylabel='shannon'&gt;\n&lt;Axes: xlabel='body_site', ylabel='shannon'&gt;\nText(0.5, 1.0, 'Shannon diversity by body site')\nText(0.5, 0, 'Body site')\nText(0, 0.5, 'Shannon diversity')\n[None, None, None, None, None, None, None, None]\n&lt;Axes: xlabel='body_site', ylabel='simpson'&gt;\n&lt;Axes: xlabel='body_site', ylabel='simpson'&gt;\nText(0.5, 1.0, 'Simpson diversity by body site')\nText(0.5, 0, 'Body site')\nText(0, 0.5, 'Simpson diversity')\n[None, None, None, None, None, None, None, None]\n&lt;Axes: xlabel='body_site', ylabel='pielou'&gt;\n&lt;Axes: xlabel='body_site', ylabel='pielou'&gt;\nText(0.5, 1.0, 'Pielou evenness by body site')\nText(0.5, 0, 'Body site')\nText(0, 0.5, 'Pielou evenness')\n[None, None, None, None, None, None, None, None]",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#depth-sensitivity-check-python",
    "href": "05-diversity-analysis.html#depth-sensitivity-check-python",
    "title": "Diversity Analysis",
    "section": "Depth Sensitivity Check (Python)",
    "text": "Depth Sensitivity Check (Python)\n\nimport numpy as np\n\ndf = pd.read_csv(\"outputs/tables/alpha-diversity.csv\")\n\nplt.figure(figsize=(8.5,5))\nsns.scatterplot(data=df, x=\"library_size\", y=\"observed\", alpha=0.7)\n\ncoef = np.polyfit(df[\"library_size\"], df[\"observed\"], 1)\nx = np.linspace(df[\"library_size\"].min(), df[\"library_size\"].max(), 200)\nplt.plot(x, coef[0]*x + coef[1])\n\nplt.title(\"Observed richness vs sequencing depth\")\nplt.xlabel(\"Library size\")\nplt.ylabel(\"Observed richness\")\n\nsns.despine()\nplt.tight_layout()\nplt.show()",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "05-diversity-analysis.html#interpretation",
    "href": "05-diversity-analysis.html#interpretation",
    "title": "Diversity Analysis",
    "section": "Interpretation",
    "text": "Interpretation\n\nObserved richness is highly depth-sensitive.\nShannon and Simpson reduce some sensitivity but do not eliminate it.\nIf richness increases strongly with depth, group comparisons may reflect sequencing effort rather than ecology.\n\n\nWhat these plots show\n\nDistribution of diversity within groups\n\nVariability across samples\n\nDominance vs evenness patterns\n\n\n\nWhat they do not show\n\nAbsolute abundance\n\nStatistical significance\n\nCausation\n\nConfounder adjustment\n\nAlpha diversity is descriptive unless formally tested.",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Diversity Analysis</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html",
    "href": "06-ordination-plots.html",
    "title": "Ordination Plots",
    "section": "",
    "text": "Load data\nOrdination reduces a complex community table into a small number of axes that summarize between-sample dissimilarity.\nThe goal is not to compress biology into two numbers. The goal is to visualize structure, then interpret it cautiously.\nThis chapter focuses on:\nlibrary(phyloseq)\nlibrary(vegan)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#transform-to-relative-abundance",
    "href": "06-ordination-plots.html#transform-to-relative-abundance",
    "title": "Ordination Plots",
    "section": "Transform to relative abundance",
    "text": "Transform to relative abundance\nBray–Curtis is commonly applied to relative abundance in exploratory ordination. This does not remove compositional constraints, but it enables clearer comparison across samples.\n\nps_rel &lt;- phyloseq::transform_sample_counts(ps, function(x) x / sum(x))\n\n\nRelative abundance ordination is descriptive.\nIf you change filtering or aggregation choices, the geometry can change. This is expected and should be reported.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#compute-braycurtis-distance",
    "href": "06-ordination-plots.html#compute-braycurtis-distance",
    "title": "Ordination Plots",
    "section": "Compute Bray–Curtis distance",
    "text": "Compute Bray–Curtis distance\n\ndist_bc &lt;- phyloseq::distance(ps_rel, method = \"bray\")\ndist_bc\n\n          L1S105    L1S140    L1S208    L1S257    L1S281     L1S57     L1S76\nL1S140 0.6861838                                                            \nL1S208 0.6354987 0.3372080                                                  \nL1S257 0.6768454 0.4388476 0.2702215                                        \nL1S281 0.7195914 0.3990832 0.2594049 0.2955335                              \nL1S57  0.3106120 0.7252243 0.7422412 0.7606517 0.7471986                    \nL1S76  0.2863643 0.7120062 0.7159927 0.7417853 0.7207266 0.2189226          \nL1S8   0.4512654 0.6795777 0.7973102 0.8243985 0.8599067 0.3791323 0.3615239\nL2S155 0.9909207 0.9947296 0.9953983 0.9968108 0.9983371 0.9945933 0.9956765\nL2S175 0.9909995 0.9961843 0.9958106 0.9972231 0.9986320 0.9957774 0.9963520\nL2S204 0.9849699 0.9921312 0.9914588 0.9922580 0.9936669 0.9858092 0.9863838\nL2S222 0.9780206 0.9899924 0.9920639 0.9926342 0.9906414 0.9862469 0.9821148\nL2S240 0.9987646 0.9955455 0.9964632 0.9990941 0.9994072 0.9988327 0.9994072\nL2S309 0.9782157 0.9723896 0.9612015 0.9676636 0.9612403 0.9774489 0.9788584\nL2S357 0.9879793 0.9929860 0.9917003 0.9931128 0.9945217 0.9880474 0.9886220\nL2S382 0.9953728 0.9984643 0.9971786 0.9985911 1.0000000 0.9994254 1.0000000\nL3S242 0.4805294 0.7271526 0.8252262 0.8516653 0.8850555 0.4064393 0.3737848\nL3S294 1.0000000 0.9984643 0.9977920 0.9985911 1.0000000 0.9994254 1.0000000\nL3S313 0.9825722 0.9898827 0.9926455 0.9940580 0.9954669 0.9894526 0.9900272\nL3S341 0.9871516 1.0000000 0.9986506 0.9989042 1.0000000 0.9885655 0.9885655\nL3S360 0.9962614 0.9834881 0.9827521 0.9823923 0.9834881 0.9969040 0.9969040\nL3S378 0.7369703 0.2481115 0.3884257 0.4760457 0.4552850 0.7531227 0.7657090\nL4S112 0.9841295 0.9895734 0.9911834 0.9925959 0.9940048 0.9868355 0.9874101\nL4S137 0.9928269 0.9957148 0.9966694 0.9980819 0.9994908 0.9989163 0.9994908\nL4S63  0.9915745 0.9917973 0.9971786 0.9985911 1.0000000 0.9994254 1.0000000\nL5S104 0.9955097 1.0000000 0.9970559 0.9996869 1.0000000 0.9949351 0.9955097\nL5S155 0.9950000 0.9950000 0.9920559 0.9946869 0.9950000 0.9944254 0.9950000\nL5S174 1.0000000 1.0000000 0.9970559 0.9996869 1.0000000 0.9994254 1.0000000\nL5S203 1.0000000 0.9976326 0.9946885 0.9973195 0.9976326 0.9994254 1.0000000\nL5S222 1.0000000 1.0000000 0.9970559 0.9996869 1.0000000 0.9994254 1.0000000\nL5S240 0.9993573 0.9944196 0.9923343 0.9941066 0.9944196 0.9994254 1.0000000\nL6S20  0.9993573 0.9988330 0.9958889 0.9985199 0.9988330 0.9994254 1.0000000\nL6S68  0.9993573 0.9991639 0.9962198 0.9988508 0.9991639 0.9994254 1.0000000\nL6S93  0.9953728 0.9987056 0.9957615 0.9983925 0.9987056 0.9994254 1.0000000\n            L1S8    L2S155    L2S175    L2S204    L2S222    L2S240    L2S309\nL1S140                                                                      \nL1S208                                                                      \nL1S257                                                                      \nL1S281                                                                      \nL1S57                                                                       \nL1S76                                                                       \nL1S8                                                                        \nL2S155 0.9907000                                                            \nL2S175 0.9909489 0.5900299                                                  \nL2S204 0.9821182 0.8136886 0.7987192                                        \nL2S222 0.9848453 0.7831451 0.7634378 0.7288398                              \nL2S240 0.9940041 0.8953950 0.8455883 0.9479622 0.9426599                    \nL2S309 0.9868822 0.6926222 0.5519007 0.7472176 0.7860768 0.8544109          \nL2S357 0.9836455 0.6700035 0.5397253 0.6763091 0.8207944 0.8174676 0.4116314\nL2S382 0.9951316 0.7855241 0.7232100 0.8972879 0.8798106 0.8528749 0.7358669\nL3S242 0.1485585 0.9874233 0.9876866 0.9882576 0.9908341 0.9893738 0.9824456\nL3S294 0.9957344 0.3404962 0.6707680 0.8381657 0.8485564 0.9407977 0.7593781\nL3S313 0.9850507 0.5850473 0.3144351 0.8244462 0.8191921 0.8483894 0.5192259\nL3S341 0.9878546 0.7874072 0.7076779 0.4249104 0.8180087 0.8872448 0.6746743\nL3S360 0.9969040 0.8555033 0.8496532 0.7097201 0.4929728 0.9459853 0.7706273\nL3S378 0.7341648 0.9958178 0.9975981 0.9975981 0.9928915 0.9922015 0.9715234\nL4S112 0.9820070 0.6706180 0.5194163 0.7157193 0.7715494 0.8009639 0.4297393\nL4S137 0.9940877 0.7556410 0.5945486 0.8732522 0.8527641 0.7851720 0.6520813\nL4S63  0.9963995 0.6760549 0.6739303 0.7356027 0.7028374 0.8947491 0.4526595\nL5S104 0.9901066 0.8546264 0.8213260 0.9217288 0.9454032 0.4014934 0.8360600\nL5S155 0.9895969 0.9006047 0.8442468 0.9632679 0.9576404 0.4471313 0.8833956\nL5S174 0.9945969 0.9235950 0.8693045 0.9632679 0.9576404 0.5189250 0.9113859\nL5S203 0.9945969 0.8647620 0.7941131 0.9518683 0.9448846 0.4275352 0.8499714\nL5S222 0.9952925 0.9180795 0.8737022 0.9552545 0.9493104 0.4545292 0.8963598\nL5S240 0.9945969 0.9130923 0.8561876 0.9556681 0.9475996 0.1356729 0.8621809\nL6S20  0.9945969 0.9437228 0.9032973 0.9552305 0.9481993 0.3400844 0.9012498\nL6S68  0.9945969 0.8880466 0.8440185 0.9479972 0.9397157 0.2119781 0.8352254\nL6S93  0.9945969 0.8959667 0.8477541 0.9451642 0.9375584 0.4006562 0.8496055\n          L2S357    L2S382    L3S242    L3S294    L3S313    L3S341    L3S360\nL1S140                                                                      \nL1S208                                                                      \nL1S257                                                                      \nL1S281                                                                      \nL1S57                                                                       \nL1S76                                                                       \nL1S8                                                                        \nL2S155                                                                      \nL2S175                                                                      \nL2S204                                                                      \nL2S222                                                                      \nL2S240                                                                      \nL2S309                                                                      \nL2S357                                                                      \nL2S382 0.7310140                                                            \nL3S242 0.9828026 0.9902684                                                  \nL3S294 0.7190127 0.8585569 0.9955407                                        \nL3S313 0.4918246 0.7499370 0.9845268 0.6315274                              \nL3S341 0.5583873 0.8318545 0.9684986 0.8174127 0.7528730                    \nL3S360 0.7687725 0.8798619 1.0000000 0.8984495 0.8760740 0.7345979          \nL3S378 0.9963339 0.9975981 0.7372373 0.9975981 0.9975981 0.9830451 0.9841822\nL4S112 0.2575579 0.7019572 0.9833718 0.7322767 0.4975492 0.6043310 0.7654843\nL4S137 0.5967539 0.4768818 0.9894574 0.8293720 0.6955663 0.7637356 0.8593176\nL4S63  0.5408874 0.8090827 0.9919628 0.7465676 0.6184667 0.7375606 0.7788989\nL5S104 0.8125098 0.8394030 0.9854762 0.9298766 0.8321425 0.8666115 0.9318885\nL5S155 0.8637793 0.8641404 0.9849666 0.9542857 0.8198937 0.9116424 0.9618163\nL5S174 0.8902437 0.8916929 0.9899666 0.9526531 0.8714097 0.9296200 0.9638803\nL5S203 0.8296442 0.8178984 0.9899666 0.9264483 0.8123412 0.8979114 0.9534636\nL5S222 0.8857399 0.8871409 0.9908559 0.9493130 0.8817394 0.9145939 0.9591203\nL5S240 0.8263406 0.8625650 0.9899666 0.9526531 0.8628011 0.8962483 0.9417881\nL6S20  0.8672378 0.8898494 0.9899666 0.9584025 0.9110211 0.9297369 0.9484772\nL6S68  0.8072302 0.8238861 0.9899666 0.9398560 0.8646681 0.8714408 0.9451945\nL6S93  0.8092837 0.8158719 0.9899666 0.9361907 0.8689997 0.8597575 0.9414717\n          L3S378    L4S112    L4S137     L4S63    L5S104    L5S155    L5S174\nL1S140                                                                      \nL1S208                                                                      \nL1S257                                                                      \nL1S281                                                                      \nL1S57                                                                       \nL1S76                                                                       \nL1S8                                                                        \nL2S155                                                                      \nL2S175                                                                      \nL2S204                                                                      \nL2S222                                                                      \nL2S240                                                                      \nL2S309                                                                      \nL2S357                                                                      \nL2S382                                                                      \nL3S242                                                                      \nL3S294                                                                      \nL3S313                                                                      \nL3S341                                                                      \nL3S360                                                                      \nL3S378                                                                      \nL4S112 0.9975981                                                            \nL4S137 0.9970889 0.5680203                                                  \nL4S63  0.9962639 0.5068493 0.7707000                                        \nL5S104 0.9975981 0.8070114 0.7911794 0.9132800                              \nL5S155 0.9925981 0.8430496 0.8207389 0.9220033 0.3778339                    \nL5S174 0.9975981 0.8679552 0.8469996 0.9221059 0.5073626 0.4990604          \nL5S203 0.9952307 0.8051266 0.7738353 0.9145115 0.3362083 0.2053220 0.4396456\nL5S222 0.9975981 0.8689426 0.8382419 0.9130828 0.4418247 0.3424239 0.3885819\nL5S240 0.9920177 0.8194116 0.8028240 0.9055829 0.3809196 0.4451662 0.5493652\nL6S20  0.9964310 0.8616005 0.8386636 0.9150477 0.6114991 0.6637454 0.6181351\nL6S68  0.9967620 0.7963094 0.7640087 0.8968638 0.4620512 0.5587941 0.6122908\nL6S93  0.9963037 0.7985092 0.7466046 0.8997108 0.5636800 0.6662455 0.5615285\n          L5S203    L5S222    L5S240     L6S20     L6S68\nL1S140                                                  \nL1S208                                                  \nL1S257                                                  \nL1S281                                                  \nL1S57                                                   \nL1S76                                                   \nL1S8                                                    \nL2S155                                                  \nL2S175                                                  \nL2S204                                                  \nL2S222                                                  \nL2S240                                                  \nL2S309                                                  \nL2S357                                                  \nL2S382                                                  \nL3S242                                                  \nL3S294                                                  \nL3S313                                                  \nL3S341                                                  \nL3S360                                                  \nL3S378                                                  \nL4S112                                                  \nL4S137                                                  \nL4S63                                                   \nL5S104                                                  \nL5S155                                                  \nL5S174                                                  \nL5S203                                                  \nL5S222 0.2366401                                        \nL5S240 0.4458029 0.5049871                              \nL6S20  0.5598046 0.5913625 0.3448338                    \nL6S68  0.4859858 0.5030199 0.2389513 0.2872778          \nL6S93  0.5680773 0.5414293 0.4194497 0.4576859 0.3980151",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#pcoa-ordination",
    "href": "06-ordination-plots.html#pcoa-ordination",
    "title": "Ordination Plots",
    "section": "PCoA ordination",
    "text": "PCoA ordination\n\nord &lt;- phyloseq::ordinate(ps_rel, method = \"PCoA\", distance = dist_bc)\n\n# Coordinates for the first two axes\ncoords &lt;- as.data.frame(ord$vectors[, 1:2])\ncolnames(coords) &lt;- c(\"PC1\", \"PC2\")\n\n# Percent variance explained (if available)\neig &lt;- ord$values$Relative_eig\nvar_pc1 &lt;- if (!is.null(eig) && length(eig) &gt;= 1) eig[1] * 100 else NA_real_\nvar_pc2 &lt;- if (!is.null(eig) && length(eig) &gt;= 2) eig[2] * 100 else NA_real_\n\nmeta &lt;- data.frame(phyloseq::sample_data(ps_rel))\nmeta$sample_id &lt;- rownames(meta)\n\ncoords$sample_id &lt;- rownames(coords)\nord_df &lt;- merge(coords, meta, by = \"sample_id\", all.x = TRUE)\n\n# Robust body site column detection\ncols &lt;- names(ord_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\n\nif (length(body_col) == 0) {\n  stop(\"Body site column not found in metadata. Available columns: \", paste(cols, collapse = \", \"))\n}\n\nord_df$body_site &lt;- ord_df[[body_col[1]]]\n\n# Store variance labels for plotting\nord_df$pc1_label &lt;- ifelse(is.na(var_pc1), \"PC1\", sprintf(\"PC1 (%.1f%%)\", var_pc1))\nord_df$pc2_label &lt;- ifelse(is.na(var_pc2), \"PC2\", sprintf(\"PC2 (%.1f%%)\", var_pc2))\n\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nreadr::write_csv(ord_df, \"outputs/tables/ordination-pcoa.csv\")\n\n# Save variance info (optional)\nvar_df &lt;- data.frame(PC1 = var_pc1, PC2 = var_pc2)\nreadr::write_csv(var_df, \"outputs/tables/ordination-variance.csv\")\n\nhead(ord_df[, c(\"sample_id\",\"PC1\",\"PC2\",\"body_site\")])\n\n  sample_id       PC1        PC2 body_site\n1    L1S105 0.5304992 0.08234422       gut\n2    L1S140 0.5307266 0.08936046       gut\n3    L1S208 0.5185157 0.08949133       gut\n4    L1S257 0.4958304 0.08236422       gut\n5    L1S281 0.4923930 0.08187132       gut\n6     L1S57 0.5167373 0.08345351       gut\n\n\n\nPCoA axes are not biological variables.\nThey are directions that best summarize pairwise dissimilarities. Axis labels are useful, but do not overinterpret them.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#ordination-plot-python",
    "href": "06-ordination-plots.html#ordination-plot-python",
    "title": "Ordination Plots",
    "section": "Ordination plot (Python)",
    "text": "Ordination plot (Python)\nThis plot uses Python for a clean, modern visualization layer. It includes points, group centroids, and confidence ellipses.\n\nimport pandas as pd\nimport numpy as np\nimport seaborn as sns\nimport matplotlib.pyplot as plt\nfrom matplotlib.patches import Ellipse\n\ndf = pd.read_csv(\"outputs/tables/ordination-pcoa.csv\").dropna(subset=[\"body_site\"])\n\n# Palette customization\npalette_name = \"Set1\"   # Try: \"Set1\", \"tab10\", \"colorblind\", \"viridis\"\ngroups = list(df[\"body_site\"].astype(str).unique())\npalette = sns.color_palette(palette_name, n_colors=len(groups))\ncolor_map = dict(zip(groups, palette))\n\nsns.set_theme(style=\"whitegrid\", context=\"notebook\")\n\ndef add_confidence_ellipse(ax, x, y, n_std=1.96, **kwargs):\n    x = np.asarray(x)\n    y = np.asarray(y)\n    if len(x) &lt; 3:\n        return\n\n    cov = np.cov(x, y)\n    if np.any(~np.isfinite(cov)):\n        return\n\n    vals, vecs = np.linalg.eigh(cov)\n    order = vals.argsort()[::-1]\n    vals = vals[order]\n    vecs = vecs[:, order]\n\n    theta = np.degrees(np.arctan2(*vecs[:, 0][::-1]))\n\n    width, height = 2 * n_std * np.sqrt(vals)\n    ell = Ellipse(\n        xy=(np.mean(x), np.mean(y)),\n        width=width,\n        height=height,\n        angle=theta,\n        **kwargs\n    )\n    ax.add_patch(ell)\n\n# Axis labels with variance if present\npc1_label = df[\"pc1_label\"].iloc[0] if \"pc1_label\" in df.columns else \"PC1\"\npc2_label = df[\"pc2_label\"].iloc[0] if \"pc2_label\" in df.columns else \"PC2\"\n\nfig, ax = plt.subplots(figsize=(8.5, 6))\n\n# Points\nsns.scatterplot(\n    data=df,\n    x=\"PC1\",\n    y=\"PC2\",\n    hue=\"body_site\",\n    palette=color_map,\n    s=65,\n    alpha=0.85,\n    edgecolor=\"black\",\n    linewidth=0.35,\n    ax=ax\n)\n\n# Centroids and ellipses\nfor g in groups:\n    sub = df[df[\"body_site\"].astype(str) == g]\n    cx, cy = sub[\"PC1\"].mean(), sub[\"PC2\"].mean()\n\n    ax.scatter([cx], [cy], s=160, marker=\"X\", edgecolor=\"black\", linewidth=0.6, zorder=5)\n\n    add_confidence_ellipse(\n        ax,\n        sub[\"PC1\"],\n        sub[\"PC2\"],\n        n_std=1.96,\n        facecolor=color_map[g],\n        alpha=0.12,\n        edgecolor=color_map[g],\n        linewidth=1.2\n    )\n\nax.set_title(\"PCoA (Bray–Curtis distance)\", weight=\"bold\")\nax.set_xlabel(pc1_label)\nax.set_ylabel(pc2_label)\n\nax.axhline(0, linewidth=0.6, alpha=0.6)\nax.axvline(0, linewidth=0.6, alpha=0.6)\n\nsns.despine(ax=ax)\nax.legend(title=\"Body site\", bbox_to_anchor=(1.02, 1), loc=\"upper left\", frameon=False)\n\nfig.tight_layout()\nplt.show()\n\n\n\n\n\n\n\n\n\nInterpretation starts with distance.\nPoints close together represent samples with similar community composition under the chosen distance and preprocessing. Points far apart represent larger compositional differences.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#reading-the-plot-responsibly",
    "href": "06-ordination-plots.html#reading-the-plot-responsibly",
    "title": "Ordination Plots",
    "section": "Reading the plot responsibly",
    "text": "Reading the plot responsibly\n\nWhat clustering can suggest\n\nDistinct clusters by group can indicate systematic differences in composition.\nOverlap can indicate weak separation or high within-group variability.\nA single outlier can stretch the geometry and distort visual separation.\n\n\n\nWhat ordination does not tell you\n\nIt does not identify which taxa drive separation.\nIt does not prove statistical significance.\nIt does not separate technical effects from biology.\n\n\nA clean separation in an ordination plot is a hypothesis generator.\nIt should lead to targeted follow-up, not a final conclusion.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#optional-permanova-group-differences",
    "href": "06-ordination-plots.html#optional-permanova-group-differences",
    "title": "Ordination Plots",
    "section": "Optional: PERMANOVA (group differences)",
    "text": "Optional: PERMANOVA (group differences)\nPERMANOVA tests whether group centroids differ in multivariate space.\n\nmeta_df &lt;- data.frame(phyloseq::sample_data(ps_rel))\ncols &lt;- names(meta_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\n\nif (length(body_col) == 0) {\n  stop(\"Body site column not found for PERMANOVA.\")\n}\n\nmeta_df$body_site &lt;- meta_df[[body_col[1]]]\n\nvegan::adonis2(dist_bc ~ body_site, data = meta_df)\n\nPermutation test for adonis under reduced model\nPermutation: free\nNumber of permutations: 999\n\nvegan::adonis2(formula = dist_bc ~ body_site, data = meta_df)\n         Df SumOfSqs      R2      F Pr(&gt;F)    \nModel     3   5.2330 0.42437 7.3723  0.001 ***\nResidual 30   7.0982 0.57563                  \nTotal    33  12.3312 1.00000                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\nA significant PERMANOVA result means group centroids differ.\nIt can also be driven by unequal within-group dispersion. This is why dispersion should be checked.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#optional-dispersion-check-beta-dispersion",
    "href": "06-ordination-plots.html#optional-dispersion-check-beta-dispersion",
    "title": "Ordination Plots",
    "section": "Optional: dispersion check (beta dispersion)",
    "text": "Optional: dispersion check (beta dispersion)\n\nmeta_df &lt;- data.frame(phyloseq::sample_data(ps_rel))\ncols &lt;- names(meta_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\n\nmeta_df$body_site &lt;- meta_df[[body_col[1]]]\n\nbd &lt;- vegan::betadisper(dist_bc, group = meta_df$body_site)\nbd\n\n\n    Homogeneity of multivariate dispersions\n\nCall: vegan::betadisper(d = dist_bc, group = meta_df$body_site)\n\nNo. of Positive Eigenvalues: 29\nNo. of Negative Eigenvalues: 4\n\nAverage distance to median:\n       gut  left palm right palm     tongue \n    0.3950     0.4991     0.5487     0.3160 \n\nEigenvalues for PCoA axes:\n(Showing 8 of 33 eigenvalues)\n PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 \n3.8480 2.6660 1.1788 0.8376 0.6125 0.5090 0.4639 0.4153 \n\nvegan::permutest(bd)\n\n\nPermutation test for homogeneity of multivariate dispersions\nPermutation: free\nNumber of permutations: 999\n\nResponse: Distances\n          Df  Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)    \nGroups     3 0.28883 0.096278 9.0096    999  0.001 ***\nResiduals 30 0.32059 0.010686                         \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n\n\nIf dispersion differs strongly across groups, PERMANOVA can appear significant even without true centroid separation.\nInterpretation should report both results.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "06-ordination-plots.html#takeaway",
    "href": "06-ordination-plots.html#takeaway",
    "title": "Ordination Plots",
    "section": "Takeaway",
    "text": "Takeaway\n\nOrdination summarizes dissimilarity, not biology.\nThe distance metric and preprocessing choices define the geometry.\nVisual separation is descriptive. Statistical tests support interpretation.\nAlways check dispersion when using PERMANOVA.",
    "crumbs": [
      "<span class='chapter-number'>7</span>  <span class='chapter-title'>Ordination Plots</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html",
    "href": "07-heatmaps-and-patterns.html",
    "title": "Heatmaps and Patterns",
    "section": "",
    "text": "Load data\nHeatmaps summarize many taxa across many samples at once.\nThey are useful for pattern discovery, but they are also easy to overread. A heatmap is a visualization of a transformed matrix, not a direct picture of biology.\nThis chapter focuses on:\nlibrary(phyloseq)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#decide-what-to-heatmap",
    "href": "07-heatmaps-and-patterns.html#decide-what-to-heatmap",
    "title": "Heatmaps and Patterns",
    "section": "Decide what to heatmap",
    "text": "Decide what to heatmap\nHeatmaps work best when the matrix:\n\nhas been transformed (raw counts are dominated by depth)\nhas a limited number of taxa (readable signal)\nis aligned to metadata (so patterns can be interpreted)\n\nWe will create a genus-level heatmap using the top taxa by mean relative abundance.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#transform-to-relative-abundance-and-aggregate-to-genus",
    "href": "07-heatmaps-and-patterns.html#transform-to-relative-abundance-and-aggregate-to-genus",
    "title": "Heatmaps and Patterns",
    "section": "Transform to relative abundance and aggregate to genus",
    "text": "Transform to relative abundance and aggregate to genus\n\nps_rel &lt;- phyloseq::transform_sample_counts(ps, function(x) x / sum(x))\n\nps_genus &lt;- phyloseq::tax_glom(ps_rel, taxrank = \"Genus\")\nps_genus &lt;- phyloseq::subset_taxa(ps_genus, !is.na(Genus))\n\nphyloseq::ntaxa(ps_genus)\n\n[1] 197\n\n\n\nAggregation improves readability, but it hides within-genus variation.\nHeatmap patterns should be interpreted at the chosen resolution.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#select-top-genera",
    "href": "07-heatmaps-and-patterns.html#select-top-genera",
    "title": "Heatmaps and Patterns",
    "section": "Select top genera",
    "text": "Select top genera\n\ngenus_mean &lt;- phyloseq::taxa_sums(ps_genus) / phyloseq::nsamples(ps_genus)\n\ntop_n &lt;- 30\ntop_genera &lt;- names(sort(genus_mean, decreasing = TRUE))[1:top_n]\n\nps_top &lt;- phyloseq::prune_taxa(top_genera, ps_genus)\nphyloseq::ntaxa(ps_top)\n\n[1] 30",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#build-the-heatmap-matrix-r-python",
    "href": "07-heatmaps-and-patterns.html#build-the-heatmap-matrix-r-python",
    "title": "Heatmaps and Patterns",
    "section": "Build the heatmap matrix (R → Python)",
    "text": "Build the heatmap matrix (R → Python)\nWe will export a clean matrix for Python plotting:\n\nrows: taxa (Genus)\ncolumns: samples\nvalues: centered log ratio style is premium-level; for free we use log1p relative abundance\n\nWe also export metadata to annotate columns.\n\n# Extract matrix\nmat &lt;- methods::as(phyloseq::otu_table(ps_top), \"matrix\")\nif (!phyloseq::taxa_are_rows(ps_top)) {\n  mat &lt;- t(mat)\n}\n\n# Log transform for heatmap stability (free-track choice)\nmat_log &lt;- log1p(mat)\n\n# Taxon labels\ntax &lt;- as.data.frame(phyloseq::tax_table(ps_top))\ntax$taxon_id &lt;- rownames(tax)\n\n# Prefer Genus as label, fallback to taxon id if needed\nlabel &lt;- tax$Genus\nlabel[is.na(label) | label == \"\"] &lt;- tax$taxon_id[is.na(label) | label == \"\"]\n\n# Apply labels\nrownames(mat_log) &lt;- make.unique(as.character(label))\n\n# Export matrix\ndir.create(\"outputs/tables\", recursive = TRUE, showWarnings = FALSE)\nmat_log_df &lt;- tibble::as_tibble(mat_log, rownames = \"taxon\")\nreadr::write_csv(mat_log_df, \"outputs/tables/heatmap-matrix.csv\")\n\n# Export metadata (for column annotation)\nmeta &lt;- data.frame(phyloseq::sample_data(ps_top))\nmeta$sample_id &lt;- rownames(meta)\n\n# Robust body site detection\ncols &lt;- names(meta)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\n\nif (length(body_col) == 0) {\n  stop(\"Body site column not found in metadata. Available columns: \", paste(cols, collapse = \", \"))\n}\n\nmeta$body_site &lt;- meta[[body_col[1]]]\n\nmeta_out &lt;- meta[, c(\"sample_id\", \"body_site\")]\nreadr::write_csv(meta_out, \"outputs/tables/heatmap-metadata.csv\")\n\n# Quick sanity check\ndim(mat_log)\n\n[1] 30 34\n\n\n\nThe transformation you choose defines what “pattern” means.\nLog1p reduces dominance effects, making mid-abundance taxa visible. Premium extensions can explore CLR and compositional heatmaps.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#heatmap-python-seaborn",
    "href": "07-heatmaps-and-patterns.html#heatmap-python-seaborn",
    "title": "Heatmaps and Patterns",
    "section": "Heatmap (Python, seaborn)",
    "text": "Heatmap (Python, seaborn)\nThis is a modern heatmap with hierarchical clustering.\n\nRows cluster by taxa similarity\nColumns cluster by sample similarity\nBody site is used as a column annotation\n\n\nimport pandas as pd\nimport seaborn as sns\nimport matplotlib.pyplot as plt\n\nmat = pd.read_csv(\"outputs/tables/heatmap-matrix.csv\", index_col=0)\nmeta = pd.read_csv(\"outputs/tables/heatmap-metadata.csv\")\n\n# Align metadata order to matrix columns\nmeta = meta.set_index(\"sample_id\").reindex(mat.columns)\n\n# Palette customization for annotations\npalette_name = \"Set1\"   # Try: \"Set1\", \"tab10\", \"colorblind\"\nsites = meta[\"body_site\"].astype(str).unique().tolist()\nsite_colors = dict(zip(sites, sns.color_palette(palette_name, n_colors=len(sites))))\ncol_colors = meta[\"body_site\"].astype(str).map(site_colors)\n\nsns.set_theme(style=\"white\")\n\ng = sns.clustermap(\n    mat,\n    method=\"average\",\n    metric=\"euclidean\",\n    col_colors=col_colors,\n    cmap=\"viridis\",\n    figsize=(10, 9),\n    xticklabels=False,\n    yticklabels=True\n)\n\n# Legend for body site annotation\nfor site, c in site_colors.items():\n    g.ax_col_dendrogram.bar(0, 0, color=c, label=site, linewidth=0)\n\ng.ax_col_dendrogram.legend(\n    title=\"Body site\",\n    loc=\"center\",\n    ncol=1,\n    bbox_to_anchor=(1.12, 0.5),\n    frameon=False\n)\n\nplt.show()\n\n\n\n\n\n\n\n\n\nClustering is a pattern-finding tool.\nClusters should be treated as hypotheses until validated with targeted analysis.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#reading-heatmaps-responsibly",
    "href": "07-heatmaps-and-patterns.html#reading-heatmaps-responsibly",
    "title": "Heatmaps and Patterns",
    "section": "Reading heatmaps responsibly",
    "text": "Reading heatmaps responsibly\n\nWhat patterns can suggest\n\nTaxa that co-occur across samples\nGroup structure (samples that cluster together)\nDominance patterns (taxa that stand out repeatedly)\n\n\n\nCommon misinterpretations\n\nClustering does not imply causation\nBright color does not automatically imply biological importance\nHeatmaps are highly sensitive to:\n\ntransformation\nfiltering and top-N selection\ndistance metric and linkage method\n\n\n\nHeatmaps are not “results” by themselves.\nThey are a compact way to inspect structure and generate questions for follow-up.",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "07-heatmaps-and-patterns.html#premium-extension-idea-kept-for-later",
    "href": "07-heatmaps-and-patterns.html#premium-extension-idea-kept-for-later",
    "title": "Heatmaps and Patterns",
    "section": "Premium extension idea (kept for later)",
    "text": "Premium extension idea (kept for later)\nIn premium, you can add:\n\nCLR transformation and compositional heatmaps\nper-group mean heatmaps (reduces sample noise)\ndifferential abundance overlays (results + visualization)\nstability checks: does clustering persist under alternative transformations?",
    "crumbs": [
      "<span class='chapter-number'>8</span>  <span class='chapter-title'>Heatmaps and Patterns</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html",
    "href": "08-summary-and-next-steps.html",
    "title": "Summary and Next Steps",
    "section": "",
    "text": "What you can now do\nThis guide introduced a practical workflow for visualizing microbiome data.\nThe goal was not to memorize plotting code. The goal was to build a reliable interpretation habit:\nBy the end of this guide you can:",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#what-you-can-now-do",
    "href": "08-summary-and-next-steps.html#what-you-can-now-do",
    "title": "Summary and Next Steps",
    "section": "",
    "text": "load and reuse a canonical phyloseq object\nrecognize sparsity as a biological feature, not an error\ninterpret sequencing depth and why it matters for richness\nbuild composition plots that are honest about limitations\nread diversity plots without confusing depth effects for biology\ninterpret ordination as distance-based geometry\nuse heatmaps to discover co-occurrence patterns",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#a-compact-checklist-for-new-datasets",
    "href": "08-summary-and-next-steps.html#a-compact-checklist-for-new-datasets",
    "title": "Summary and Next Steps",
    "section": "A compact checklist for new datasets",
    "text": "A compact checklist for new datasets\nUse this checklist whenever you start a new microbiome dataset.\n\nStructure\n\nDo samples align across abundance and metadata?\nAre taxa identifiers consistent across tables?\nAre there missing or duplicated sample IDs?\n\n\n\nSparsity\n\nWhat fraction of the matrix is zero?\nAre there taxa present in only 1–2 samples?\nWill a prevalence threshold improve clarity?\n\n\n\nDepth\n\nAre library sizes comparable across groups?\nDoes observed richness strongly track depth?\nDo conclusions change under a depth sensitivity check?\n\n\n\nComposition\n\nAre you comparing proportions or absolute abundance?\nDid you state the taxonomic rank and top-N choice?\nWould the story change if you aggregated differently?\n\n\n\nDiversity and ordination\n\nWhich alpha metric matches the question?\nWhich beta distance matches the data and interpretation?\nIf you run PERMANOVA, did you check dispersion?\n\n\nMost interpretation problems come from skipping one of the checklist blocks.\nThe fix is almost always upstream, not in the plotting code.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#save-a-small-results-snapshot-r-python",
    "href": "08-summary-and-next-steps.html#save-a-small-results-snapshot-r-python",
    "title": "Summary and Next Steps",
    "section": "Save a small “results snapshot” (R → Python)",
    "text": "Save a small “results snapshot” (R → Python)\nA practical habit is to export a small results bundle that can be reloaded later.\nWe will export:\n\nlibrary size summary\nalpha diversity table\nordination coordinates\n\n\ndir.create(\"outputs/snapshots\", recursive = TRUE, showWarnings = FALSE)\n\nps &lt;- readRDS(\"data/moving-pictures-ps.rds\")\n\n# Library size\nlib_size &lt;- phyloseq::sample_sums(ps)\ndf_lib &lt;- data.frame(sample_id = names(lib_size), library_size = as.numeric(lib_size))\nreadr::write_csv(df_lib, \"outputs/snapshots/library-size.csv\")\n\n# Alpha diversity (simple, reproducible)\notu &lt;- methods::as(phyloseq::otu_table(ps), \"matrix\")\nif (!phyloseq::taxa_are_rows(ps)) otu &lt;- t(otu)\n\nobserved &lt;- colSums(otu &gt; 0)\nshannon  &lt;- vegan::diversity(t(otu), index = \"shannon\")\n\nalpha_df &lt;- data.frame(\n  sample_id = colnames(otu),\n  observed = observed,\n  shannon = shannon,\n  stringsAsFactors = FALSE\n)\n\nmeta &lt;- data.frame(phyloseq::sample_data(ps))\nmeta$sample_id &lt;- rownames(meta)\nalpha_df &lt;- merge(alpha_df, meta, by = \"sample_id\", all.x = TRUE)\n\ncols &lt;- names(alpha_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\nif (length(body_col) == 0) stop(\"Body site column not found in metadata.\")\nalpha_df$body_site &lt;- alpha_df[[body_col[1]]]\n\nreadr::write_csv(alpha_df, \"outputs/snapshots/alpha-diversity-mini.csv\")\n\n# Ordination coordinates (PCoA, Bray–Curtis, rel abundance)\nps_rel &lt;- phyloseq::transform_sample_counts(ps, function(x) x / sum(x))\ndist_bc &lt;- phyloseq::distance(ps_rel, method = \"bray\")\nord &lt;- phyloseq::ordinate(ps_rel, method = \"PCoA\", distance = dist_bc)\n\ncoords &lt;- as.data.frame(ord$vectors[, 1:2])\ncolnames(coords) &lt;- c(\"PC1\", \"PC2\")\ncoords$sample_id &lt;- rownames(coords)\n\nord_df &lt;- merge(coords, meta, by = \"sample_id\", all.x = TRUE)\ncols &lt;- names(ord_df)\nbody_col &lt;- intersect(c(\"body-site\", \"body.site\", \"body_site\"), cols)\nif (length(body_col) == 0) stop(\"Body site column not found in ordination metadata.\")\nord_df$body_site &lt;- ord_df[[body_col[1]]]\n\nreadr::write_csv(ord_df, \"outputs/snapshots/ordination-pcoa.csv\")\n\nc(\"library-size.csv\", \"alpha-diversity-mini.csv\", \"ordination-pcoa.csv\")\n\n[1] \"library-size.csv\"         \"alpha-diversity-mini.csv\"\n[3] \"ordination-pcoa.csv\"     \n\n\n\nimport pandas as pd\n\nlib = pd.read_csv(\"outputs/snapshots/library-size.csv\")\nalpha = pd.read_csv(\"outputs/snapshots/alpha-diversity-mini.csv\")\nordn = pd.read_csv(\"outputs/snapshots/ordination-pcoa.csv\")\n\nprint(\"Library size rows:\", lib.shape[0])\n\nLibrary size rows: 34\n\nprint(\"Alpha diversity rows:\", alpha.shape[0])\n\nAlpha diversity rows: 34\n\nprint(\"Ordination rows:\", ordn.shape[0])\n\nOrdination rows: 34\n\nalpha[[\"sample_id\",\"body_site\",\"observed\",\"shannon\"]].head()\n\n  sample_id body_site  observed   shannon\n0    L1S105       gut        63  2.682108\n1    L1S140       gut        65  2.660947\n2    L1S208       gut        85  3.121034\n3    L1S257       gut        81  3.262504\n4    L1S281       gut        72  3.189387\n\n\n\nA snapshot makes your workflow restartable.\nYou can reproduce plots without rerunning every upstream step. This is a small habit that prevents large confusion later.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#where-to-go-next",
    "href": "08-summary-and-next-steps.html#where-to-go-next",
    "title": "Summary and Next Steps",
    "section": "Where to Go Next",
    "text": "Where to Go Next\nIf you are continuing with this dataset:\n\nCompare taxonomic resolution (Family, Genus, ASV) and assess stability.\nExplore alternative distances (Jaccard for presence/absence; Aitchison for compositional structure).\nIdentify taxa that most strongly contribute to observed separation.\n\nIf you are starting a new dataset:\n\nRe-run the structural checklist.\nRebuild a canonical object.\nKeep transformation and filtering decisions explicit and version controlled.\n\n\n\nThe fastest way to improve interpretation is not adding more plots.\nIt is strengthening the logic that connects each plot to a defensible biological question.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#beyond-descriptive-visualization",
    "href": "08-summary-and-next-steps.html#beyond-descriptive-visualization",
    "title": "Summary and Next Steps",
    "section": "Beyond Descriptive Visualization",
    "text": "Beyond Descriptive Visualization\nThis guide focused on structural clarity and visualization:\n\ncomposition\n\ndiversity\n\nordination\n\nclustering patterns\n\nThese approaches describe what the data look like.\nThey do not yet address:\n\nWhether differences are statistically robust\n\nHow much variance is explained by specific variables\n\nHow covariates influence interpretation\n\nHow to reconcile conflicting signals across metrics\n\nThese questions require inferential modeling and more advanced analytical design.\nThe extended continuation of this guide explores:\n\nPERMANOVA and multivariate hypothesis testing\n\nconstrained ordination\n\nvariance partitioning\n\nmodel-based approaches\n\nstructured interpretation workflows\n\nThe objective is not to add more figures.\nIt is to reason more rigorously about biological signal.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  },
  {
    "objectID": "08-summary-and-next-steps.html#continue-the-learning-path",
    "href": "08-summary-and-next-steps.html#continue-the-learning-path",
    "title": "Summary and Next Steps",
    "section": "Continue the Learning Path",
    "text": "Continue the Learning Path\nThe premium continuation of this guide expands these topics in depth:\n→ https://complexdatainsights.com/microbiome-premium\nIt builds from the same dataset and structure, but moves from descriptive visualization toward formal inference and analytical decision-making.",
    "crumbs": [
      "<span class='chapter-number'>9</span>  <span class='chapter-title'>Summary and Next Steps</span>"
    ]
  }
]