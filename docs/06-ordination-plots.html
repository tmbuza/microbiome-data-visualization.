<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ordination Plots – Microbiome Data Visualization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./07-heatmaps-and-patterns.html" rel="next">
<link href="./05-diversity-analysis.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-231ef2f9d4ce3268f31ef752336c15d2.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="assets/css/cdi.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./06-ordination-plots.html"><span class="chapter-title">Ordination Plots</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Microbiome Data Visualization</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-preface.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-datasets.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-data-structure-and-prevalence.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Data Structure and Prevalence</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-composition-visualization.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Composition Visualization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-diversity-analysis.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Diversity Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-ordination-plots.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">Ordination Plots</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-heatmaps-and-patterns.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Heatmaps and Patterns</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-summary-and-next-steps.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">Summary and Next Steps</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-data" id="toc-load-data" class="nav-link active" data-scroll-target="#load-data">Load data</a></li>
  <li><a href="#transform-to-relative-abundance" id="toc-transform-to-relative-abundance" class="nav-link" data-scroll-target="#transform-to-relative-abundance">Transform to relative abundance</a></li>
  <li><a href="#compute-braycurtis-distance" id="toc-compute-braycurtis-distance" class="nav-link" data-scroll-target="#compute-braycurtis-distance">Compute Bray–Curtis distance</a></li>
  <li><a href="#pcoa-ordination" id="toc-pcoa-ordination" class="nav-link" data-scroll-target="#pcoa-ordination">PCoA ordination</a></li>
  <li><a href="#ordination-plot-python" id="toc-ordination-plot-python" class="nav-link" data-scroll-target="#ordination-plot-python">Ordination plot (Python)</a></li>
  <li><a href="#reading-the-plot-responsibly" id="toc-reading-the-plot-responsibly" class="nav-link" data-scroll-target="#reading-the-plot-responsibly">Reading the plot responsibly</a>
  <ul class="collapse">
  <li><a href="#what-clustering-can-suggest" id="toc-what-clustering-can-suggest" class="nav-link" data-scroll-target="#what-clustering-can-suggest">What clustering can suggest</a></li>
  <li><a href="#what-ordination-does-not-tell-you" id="toc-what-ordination-does-not-tell-you" class="nav-link" data-scroll-target="#what-ordination-does-not-tell-you">What ordination does not tell you</a></li>
  </ul></li>
  <li><a href="#optional-permanova-group-differences" id="toc-optional-permanova-group-differences" class="nav-link" data-scroll-target="#optional-permanova-group-differences">Optional: PERMANOVA (group differences)</a></li>
  <li><a href="#optional-dispersion-check-beta-dispersion" id="toc-optional-dispersion-check-beta-dispersion" class="nav-link" data-scroll-target="#optional-dispersion-check-beta-dispersion">Optional: dispersion check (beta dispersion)</a></li>
  <li><a href="#takeaway" id="toc-takeaway" class="nav-link" data-scroll-target="#takeaway">Takeaway</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-title">Ordination Plots</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Ordination reduces a complex community table into a small number of axes that summarize between-sample dissimilarity.</p>
<p>The goal is not to compress biology into two numbers. The goal is to visualize structure, then interpret it cautiously.</p>
<div class="cdi-message">
<p>Ordination shows patterns of similarity between samples.</p>
<p>It does not explain why samples differ. Interpretation requires context, careful preprocessing, and validation.</p>
</div>
<p>This chapter focuses on:</p>
<ul>
<li>Bray–Curtis distance and why it is common</li>
<li>PCoA ordination and what the axes mean</li>
<li>how to read clustering and overlap</li>
<li>how to avoid common interpretation traps</li>
</ul>
<hr>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phyloseq)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vegan)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>ps <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/moving-pictures-ps.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="transform-to-relative-abundance" class="level2">
<h2 class="anchored" data-anchor-id="transform-to-relative-abundance">Transform to relative abundance</h2>
<p>Bray–Curtis is commonly applied to relative abundance in exploratory ordination. This does not remove compositional constraints, but it enables clearer comparison across samples.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ps_rel <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">transform_sample_counts</span>(ps, <span class="cf">function</span>(x) x <span class="sc">/</span> <span class="fu">sum</span>(x))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cdi-message">
<p>Relative abundance ordination is descriptive.</p>
<p>If you change filtering or aggregation choices, the geometry can change. This is expected and should be reported.</p>
</div>
<hr>
</section>
<section id="compute-braycurtis-distance" class="level2">
<h2 class="anchored" data-anchor-id="compute-braycurtis-distance">Compute Bray–Curtis distance</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dist_bc <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">distance</span>(ps_rel, <span class="at">method =</span> <span class="st">"bray"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>dist_bc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          L1S105    L1S140    L1S208    L1S257    L1S281     L1S57     L1S76
L1S140 0.6861838                                                            
L1S208 0.6354987 0.3372080                                                  
L1S257 0.6768454 0.4388476 0.2702215                                        
L1S281 0.7195914 0.3990832 0.2594049 0.2955335                              
L1S57  0.3106120 0.7252243 0.7422412 0.7606517 0.7471986                    
L1S76  0.2863643 0.7120062 0.7159927 0.7417853 0.7207266 0.2189226          
L1S8   0.4512654 0.6795777 0.7973102 0.8243985 0.8599067 0.3791323 0.3615239
L2S155 0.9909207 0.9947296 0.9953983 0.9968108 0.9983371 0.9945933 0.9956765
L2S175 0.9909995 0.9961843 0.9958106 0.9972231 0.9986320 0.9957774 0.9963520
L2S204 0.9849699 0.9921312 0.9914588 0.9922580 0.9936669 0.9858092 0.9863838
L2S222 0.9780206 0.9899924 0.9920639 0.9926342 0.9906414 0.9862469 0.9821148
L2S240 0.9987646 0.9955455 0.9964632 0.9990941 0.9994072 0.9988327 0.9994072
L2S309 0.9782157 0.9723896 0.9612015 0.9676636 0.9612403 0.9774489 0.9788584
L2S357 0.9879793 0.9929860 0.9917003 0.9931128 0.9945217 0.9880474 0.9886220
L2S382 0.9953728 0.9984643 0.9971786 0.9985911 1.0000000 0.9994254 1.0000000
L3S242 0.4805294 0.7271526 0.8252262 0.8516653 0.8850555 0.4064393 0.3737848
L3S294 1.0000000 0.9984643 0.9977920 0.9985911 1.0000000 0.9994254 1.0000000
L3S313 0.9825722 0.9898827 0.9926455 0.9940580 0.9954669 0.9894526 0.9900272
L3S341 0.9871516 1.0000000 0.9986506 0.9989042 1.0000000 0.9885655 0.9885655
L3S360 0.9962614 0.9834881 0.9827521 0.9823923 0.9834881 0.9969040 0.9969040
L3S378 0.7369703 0.2481115 0.3884257 0.4760457 0.4552850 0.7531227 0.7657090
L4S112 0.9841295 0.9895734 0.9911834 0.9925959 0.9940048 0.9868355 0.9874101
L4S137 0.9928269 0.9957148 0.9966694 0.9980819 0.9994908 0.9989163 0.9994908
L4S63  0.9915745 0.9917973 0.9971786 0.9985911 1.0000000 0.9994254 1.0000000
L5S104 0.9955097 1.0000000 0.9970559 0.9996869 1.0000000 0.9949351 0.9955097
L5S155 0.9950000 0.9950000 0.9920559 0.9946869 0.9950000 0.9944254 0.9950000
L5S174 1.0000000 1.0000000 0.9970559 0.9996869 1.0000000 0.9994254 1.0000000
L5S203 1.0000000 0.9976326 0.9946885 0.9973195 0.9976326 0.9994254 1.0000000
L5S222 1.0000000 1.0000000 0.9970559 0.9996869 1.0000000 0.9994254 1.0000000
L5S240 0.9993573 0.9944196 0.9923343 0.9941066 0.9944196 0.9994254 1.0000000
L6S20  0.9993573 0.9988330 0.9958889 0.9985199 0.9988330 0.9994254 1.0000000
L6S68  0.9993573 0.9991639 0.9962198 0.9988508 0.9991639 0.9994254 1.0000000
L6S93  0.9953728 0.9987056 0.9957615 0.9983925 0.9987056 0.9994254 1.0000000
            L1S8    L2S155    L2S175    L2S204    L2S222    L2S240    L2S309
L1S140                                                                      
L1S208                                                                      
L1S257                                                                      
L1S281                                                                      
L1S57                                                                       
L1S76                                                                       
L1S8                                                                        
L2S155 0.9907000                                                            
L2S175 0.9909489 0.5900299                                                  
L2S204 0.9821182 0.8136886 0.7987192                                        
L2S222 0.9848453 0.7831451 0.7634378 0.7288398                              
L2S240 0.9940041 0.8953950 0.8455883 0.9479622 0.9426599                    
L2S309 0.9868822 0.6926222 0.5519007 0.7472176 0.7860768 0.8544109          
L2S357 0.9836455 0.6700035 0.5397253 0.6763091 0.8207944 0.8174676 0.4116314
L2S382 0.9951316 0.7855241 0.7232100 0.8972879 0.8798106 0.8528749 0.7358669
L3S242 0.1485585 0.9874233 0.9876866 0.9882576 0.9908341 0.9893738 0.9824456
L3S294 0.9957344 0.3404962 0.6707680 0.8381657 0.8485564 0.9407977 0.7593781
L3S313 0.9850507 0.5850473 0.3144351 0.8244462 0.8191921 0.8483894 0.5192259
L3S341 0.9878546 0.7874072 0.7076779 0.4249104 0.8180087 0.8872448 0.6746743
L3S360 0.9969040 0.8555033 0.8496532 0.7097201 0.4929728 0.9459853 0.7706273
L3S378 0.7341648 0.9958178 0.9975981 0.9975981 0.9928915 0.9922015 0.9715234
L4S112 0.9820070 0.6706180 0.5194163 0.7157193 0.7715494 0.8009639 0.4297393
L4S137 0.9940877 0.7556410 0.5945486 0.8732522 0.8527641 0.7851720 0.6520813
L4S63  0.9963995 0.6760549 0.6739303 0.7356027 0.7028374 0.8947491 0.4526595
L5S104 0.9901066 0.8546264 0.8213260 0.9217288 0.9454032 0.4014934 0.8360600
L5S155 0.9895969 0.9006047 0.8442468 0.9632679 0.9576404 0.4471313 0.8833956
L5S174 0.9945969 0.9235950 0.8693045 0.9632679 0.9576404 0.5189250 0.9113859
L5S203 0.9945969 0.8647620 0.7941131 0.9518683 0.9448846 0.4275352 0.8499714
L5S222 0.9952925 0.9180795 0.8737022 0.9552545 0.9493104 0.4545292 0.8963598
L5S240 0.9945969 0.9130923 0.8561876 0.9556681 0.9475996 0.1356729 0.8621809
L6S20  0.9945969 0.9437228 0.9032973 0.9552305 0.9481993 0.3400844 0.9012498
L6S68  0.9945969 0.8880466 0.8440185 0.9479972 0.9397157 0.2119781 0.8352254
L6S93  0.9945969 0.8959667 0.8477541 0.9451642 0.9375584 0.4006562 0.8496055
          L2S357    L2S382    L3S242    L3S294    L3S313    L3S341    L3S360
L1S140                                                                      
L1S208                                                                      
L1S257                                                                      
L1S281                                                                      
L1S57                                                                       
L1S76                                                                       
L1S8                                                                        
L2S155                                                                      
L2S175                                                                      
L2S204                                                                      
L2S222                                                                      
L2S240                                                                      
L2S309                                                                      
L2S357                                                                      
L2S382 0.7310140                                                            
L3S242 0.9828026 0.9902684                                                  
L3S294 0.7190127 0.8585569 0.9955407                                        
L3S313 0.4918246 0.7499370 0.9845268 0.6315274                              
L3S341 0.5583873 0.8318545 0.9684986 0.8174127 0.7528730                    
L3S360 0.7687725 0.8798619 1.0000000 0.8984495 0.8760740 0.7345979          
L3S378 0.9963339 0.9975981 0.7372373 0.9975981 0.9975981 0.9830451 0.9841822
L4S112 0.2575579 0.7019572 0.9833718 0.7322767 0.4975492 0.6043310 0.7654843
L4S137 0.5967539 0.4768818 0.9894574 0.8293720 0.6955663 0.7637356 0.8593176
L4S63  0.5408874 0.8090827 0.9919628 0.7465676 0.6184667 0.7375606 0.7788989
L5S104 0.8125098 0.8394030 0.9854762 0.9298766 0.8321425 0.8666115 0.9318885
L5S155 0.8637793 0.8641404 0.9849666 0.9542857 0.8198937 0.9116424 0.9618163
L5S174 0.8902437 0.8916929 0.9899666 0.9526531 0.8714097 0.9296200 0.9638803
L5S203 0.8296442 0.8178984 0.9899666 0.9264483 0.8123412 0.8979114 0.9534636
L5S222 0.8857399 0.8871409 0.9908559 0.9493130 0.8817394 0.9145939 0.9591203
L5S240 0.8263406 0.8625650 0.9899666 0.9526531 0.8628011 0.8962483 0.9417881
L6S20  0.8672378 0.8898494 0.9899666 0.9584025 0.9110211 0.9297369 0.9484772
L6S68  0.8072302 0.8238861 0.9899666 0.9398560 0.8646681 0.8714408 0.9451945
L6S93  0.8092837 0.8158719 0.9899666 0.9361907 0.8689997 0.8597575 0.9414717
          L3S378    L4S112    L4S137     L4S63    L5S104    L5S155    L5S174
L1S140                                                                      
L1S208                                                                      
L1S257                                                                      
L1S281                                                                      
L1S57                                                                       
L1S76                                                                       
L1S8                                                                        
L2S155                                                                      
L2S175                                                                      
L2S204                                                                      
L2S222                                                                      
L2S240                                                                      
L2S309                                                                      
L2S357                                                                      
L2S382                                                                      
L3S242                                                                      
L3S294                                                                      
L3S313                                                                      
L3S341                                                                      
L3S360                                                                      
L3S378                                                                      
L4S112 0.9975981                                                            
L4S137 0.9970889 0.5680203                                                  
L4S63  0.9962639 0.5068493 0.7707000                                        
L5S104 0.9975981 0.8070114 0.7911794 0.9132800                              
L5S155 0.9925981 0.8430496 0.8207389 0.9220033 0.3778339                    
L5S174 0.9975981 0.8679552 0.8469996 0.9221059 0.5073626 0.4990604          
L5S203 0.9952307 0.8051266 0.7738353 0.9145115 0.3362083 0.2053220 0.4396456
L5S222 0.9975981 0.8689426 0.8382419 0.9130828 0.4418247 0.3424239 0.3885819
L5S240 0.9920177 0.8194116 0.8028240 0.9055829 0.3809196 0.4451662 0.5493652
L6S20  0.9964310 0.8616005 0.8386636 0.9150477 0.6114991 0.6637454 0.6181351
L6S68  0.9967620 0.7963094 0.7640087 0.8968638 0.4620512 0.5587941 0.6122908
L6S93  0.9963037 0.7985092 0.7466046 0.8997108 0.5636800 0.6662455 0.5615285
          L5S203    L5S222    L5S240     L6S20     L6S68
L1S140                                                  
L1S208                                                  
L1S257                                                  
L1S281                                                  
L1S57                                                   
L1S76                                                   
L1S8                                                    
L2S155                                                  
L2S175                                                  
L2S204                                                  
L2S222                                                  
L2S240                                                  
L2S309                                                  
L2S357                                                  
L2S382                                                  
L3S242                                                  
L3S294                                                  
L3S313                                                  
L3S341                                                  
L3S360                                                  
L3S378                                                  
L4S112                                                  
L4S137                                                  
L4S63                                                   
L5S104                                                  
L5S155                                                  
L5S174                                                  
L5S203                                                  
L5S222 0.2366401                                        
L5S240 0.4458029 0.5049871                              
L6S20  0.5598046 0.5913625 0.3448338                    
L6S68  0.4859858 0.5030199 0.2389513 0.2872778          
L6S93  0.5680773 0.5414293 0.4194497 0.4576859 0.3980151</code></pre>
</div>
</div>
<hr>
</section>
<section id="pcoa-ordination" class="level2">
<h2 class="anchored" data-anchor-id="pcoa-ordination">PCoA ordination</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ord <span class="ot">&lt;-</span> phyloseq<span class="sc">::</span><span class="fu">ordinate</span>(ps_rel, <span class="at">method =</span> <span class="st">"PCoA"</span>, <span class="at">distance =</span> dist_bc)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Coordinates for the first two axes</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(ord<span class="sc">$</span>vectors[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(coords) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Percent variance explained (if available)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>eig <span class="ot">&lt;-</span> ord<span class="sc">$</span>values<span class="sc">$</span>Relative_eig</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>var_pc1 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(eig) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(eig) <span class="sc">&gt;=</span> <span class="dv">1</span>) eig[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span> <span class="cf">else</span> <span class="cn">NA_real_</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>var_pc2 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(eig) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(eig) <span class="sc">&gt;=</span> <span class="dv">2</span>) eig[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span> <span class="cf">else</span> <span class="cn">NA_real_</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(phyloseq<span class="sc">::</span><span class="fu">sample_data</span>(ps_rel))</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>meta<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(meta)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>coords<span class="sc">$</span>sample_id <span class="ot">&lt;-</span> <span class="fu">rownames</span>(coords)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>ord_df <span class="ot">&lt;-</span> <span class="fu">merge</span>(coords, meta, <span class="at">by =</span> <span class="st">"sample_id"</span>, <span class="at">all.x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust body site column detection</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(ord_df)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>body_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"body-site"</span>, <span class="st">"body.site"</span>, <span class="st">"body_site"</span>), cols)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(body_col) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Body site column not found in metadata. Available columns: "</span>, <span class="fu">paste</span>(cols, <span class="at">collapse =</span> <span class="st">", "</span>))</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>ord_df<span class="sc">$</span>body_site <span class="ot">&lt;-</span> ord_df[[body_col[<span class="dv">1</span>]]]</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Store variance labels for plotting</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>ord_df<span class="sc">$</span>pc1_label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(var_pc1), <span class="st">"PC1"</span>, <span class="fu">sprintf</span>(<span class="st">"PC1 (%.1f%%)"</span>, var_pc1))</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>ord_df<span class="sc">$</span>pc2_label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(var_pc2), <span class="st">"PC2"</span>, <span class="fu">sprintf</span>(<span class="st">"PC2 (%.1f%%)"</span>, var_pc2))</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">"outputs/tables"</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(ord_df, <span class="st">"outputs/tables/ordination-pcoa.csv"</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Save variance info (optional)</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>var_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">PC1 =</span> var_pc1, <span class="at">PC2 =</span> var_pc2)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(var_df, <span class="st">"outputs/tables/ordination-variance.csv"</span>)</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ord_df[, <span class="fu">c</span>(<span class="st">"sample_id"</span>,<span class="st">"PC1"</span>,<span class="st">"PC2"</span>,<span class="st">"body_site"</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  sample_id       PC1        PC2 body_site
1    L1S105 0.5304992 0.08234422       gut
2    L1S140 0.5307266 0.08936046       gut
3    L1S208 0.5185157 0.08949133       gut
4    L1S257 0.4958304 0.08236422       gut
5    L1S281 0.4923930 0.08187132       gut
6     L1S57 0.5167373 0.08345351       gut</code></pre>
</div>
</div>
<div class="cdi-message">
<p>PCoA axes are not biological variables.</p>
<p>They are directions that best summarize pairwise dissimilarities. Axis labels are useful, but do not overinterpret them.</p>
</div>
<hr>
</section>
<section id="ordination-plot-python" class="level2">
<h2 class="anchored" data-anchor-id="ordination-plot-python">Ordination plot (Python)</h2>
<p>This plot uses Python for a clean, modern visualization layer. It includes points, group centroids, and confidence ellipses.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.patches <span class="im">import</span> Ellipse</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"outputs/tables/ordination-pcoa.csv"</span>).dropna(subset<span class="op">=</span>[<span class="st">"body_site"</span>])</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Palette customization</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>palette_name <span class="op">=</span> <span class="st">"Set1"</span>   <span class="co"># Try: "Set1", "tab10", "colorblind", "viridis"</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>groups <span class="op">=</span> <span class="bu">list</span>(df[<span class="st">"body_site"</span>].astype(<span class="bu">str</span>).unique())</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(palette_name, n_colors<span class="op">=</span><span class="bu">len</span>(groups))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(groups, palette))</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, context<span class="op">=</span><span class="st">"notebook"</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add_confidence_ellipse(ax, x, y, n_std<span class="op">=</span><span class="fl">1.96</span>, <span class="op">**</span>kwargs):</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.asarray(x)</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> np.asarray(y)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(x) <span class="op">&lt;</span> <span class="dv">3</span>:</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    cov <span class="op">=</span> np.cov(x, y)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(<span class="op">~</span>np.isfinite(cov)):</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>    vals, vecs <span class="op">=</span> np.linalg.eigh(cov)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> vals.argsort()[::<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>    vals <span class="op">=</span> vals[order]</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    vecs <span class="op">=</span> vecs[:, order]</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    theta <span class="op">=</span> np.degrees(np.arctan2(<span class="op">*</span>vecs[:, <span class="dv">0</span>][::<span class="op">-</span><span class="dv">1</span>]))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    width, height <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> n_std <span class="op">*</span> np.sqrt(vals)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    ell <span class="op">=</span> Ellipse(</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        xy<span class="op">=</span>(np.mean(x), np.mean(y)),</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>width,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>height,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        angle<span class="op">=</span>theta,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">**</span>kwargs</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    ax.add_patch(ell)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Axis labels with variance if present</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>pc1_label <span class="op">=</span> df[<span class="st">"pc1_label"</span>].iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">"pc1_label"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"PC1"</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>pc2_label <span class="op">=</span> df[<span class="st">"pc2_label"</span>].iloc[<span class="dv">0</span>] <span class="cf">if</span> <span class="st">"pc2_label"</span> <span class="kw">in</span> df.columns <span class="cf">else</span> <span class="st">"PC2"</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="fl">8.5</span>, <span class="dv">6</span>))</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Points</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"PC1"</span>,</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"PC2"</span>,</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"body_site"</span>,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span>color_map,</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="dv">65</span>,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.85</span>,</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">"black"</span>,</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.35</span>,</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Centroids and ellipses</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> g <span class="kw">in</span> groups:</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    sub <span class="op">=</span> df[df[<span class="st">"body_site"</span>].astype(<span class="bu">str</span>) <span class="op">==</span> g]</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    cx, cy <span class="op">=</span> sub[<span class="st">"PC1"</span>].mean(), sub[<span class="st">"PC2"</span>].mean()</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    ax.scatter([cx], [cy], s<span class="op">=</span><span class="dv">160</span>, marker<span class="op">=</span><span class="st">"X"</span>, edgecolor<span class="op">=</span><span class="st">"black"</span>, linewidth<span class="op">=</span><span class="fl">0.6</span>, zorder<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    add_confidence_ellipse(</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        ax,</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        sub[<span class="st">"PC1"</span>],</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>        sub[<span class="st">"PC2"</span>],</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        n_std<span class="op">=</span><span class="fl">1.96</span>,</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>        facecolor<span class="op">=</span>color_map[g],</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.12</span>,</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span>color_map[g],</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">1.2</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">"PCoA (Bray–Curtis distance)"</span>, weight<span class="op">=</span><span class="st">"bold"</span>)</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(pc1_label)</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(pc2_label)</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>ax.axhline(<span class="dv">0</span>, linewidth<span class="op">=</span><span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>ax.axvline(<span class="dv">0</span>, linewidth<span class="op">=</span><span class="fl">0.6</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>sns.despine(ax<span class="op">=</span>ax)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>ax.legend(title<span class="op">=</span><span class="st">"Body site"</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">"upper left"</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>fig.tight_layout()</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="06-ordination-plots_files/figure-html/plot-ordination-seaborn-1.png" class="img-fluid figure-img" width="816"></p>
</figure>
</div>
</div>
</div>
<div class="cdi-message">
<p>Interpretation starts with distance.</p>
<p>Points close together represent samples with similar community composition under the chosen distance and preprocessing. Points far apart represent larger compositional differences.</p>
</div>
<hr>
</section>
<section id="reading-the-plot-responsibly" class="level2">
<h2 class="anchored" data-anchor-id="reading-the-plot-responsibly">Reading the plot responsibly</h2>
<section id="what-clustering-can-suggest" class="level3">
<h3 class="anchored" data-anchor-id="what-clustering-can-suggest">What clustering can suggest</h3>
<ul>
<li>Distinct clusters by group can indicate systematic differences in composition.</li>
<li>Overlap can indicate weak separation or high within-group variability.</li>
<li>A single outlier can stretch the geometry and distort visual separation.</li>
</ul>
</section>
<section id="what-ordination-does-not-tell-you" class="level3">
<h3 class="anchored" data-anchor-id="what-ordination-does-not-tell-you">What ordination does not tell you</h3>
<ul>
<li>It does not identify which taxa drive separation.</li>
<li>It does not prove statistical significance.</li>
<li>It does not separate technical effects from biology.</li>
</ul>
<div class="cdi-message">
<p>A clean separation in an ordination plot is a hypothesis generator.</p>
<p>It should lead to targeted follow-up, not a final conclusion.</p>
</div>
<hr>
</section>
</section>
<section id="optional-permanova-group-differences" class="level2">
<h2 class="anchored" data-anchor-id="optional-permanova-group-differences">Optional: PERMANOVA (group differences)</h2>
<p>PERMANOVA tests whether group centroids differ in multivariate space.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>meta_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(phyloseq<span class="sc">::</span><span class="fu">sample_data</span>(ps_rel))</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(meta_df)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>body_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"body-site"</span>, <span class="st">"body.site"</span>, <span class="st">"body_site"</span>), cols)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(body_col) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"Body site column not found for PERMANOVA."</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>meta_df<span class="sc">$</span>body_site <span class="ot">&lt;-</span> meta_df[[body_col[<span class="dv">1</span>]]]</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>vegan<span class="sc">::</span><span class="fu">adonis2</span>(dist_bc <span class="sc">~</span> body_site, <span class="at">data =</span> meta_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Permutation test for adonis under reduced model
Permutation: free
Number of permutations: 999

vegan::adonis2(formula = dist_bc ~ body_site, data = meta_df)
         Df SumOfSqs      R2      F Pr(&gt;F)    
Model     3   5.2330 0.42437 7.3723  0.001 ***
Residual 30   7.0982 0.57563                  
Total    33  12.3312 1.00000                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cdi-message">
<p>A significant PERMANOVA result means group centroids differ.</p>
<p>It can also be driven by unequal within-group dispersion. This is why dispersion should be checked.</p>
</div>
<hr>
</section>
<section id="optional-dispersion-check-beta-dispersion" class="level2">
<h2 class="anchored" data-anchor-id="optional-dispersion-check-beta-dispersion">Optional: dispersion check (beta dispersion)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>meta_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(phyloseq<span class="sc">::</span><span class="fu">sample_data</span>(ps_rel))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">names</span>(meta_df)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>body_col <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">c</span>(<span class="st">"body-site"</span>, <span class="st">"body.site"</span>, <span class="st">"body_site"</span>), cols)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>meta_df<span class="sc">$</span>body_site <span class="ot">&lt;-</span> meta_df[[body_col[<span class="dv">1</span>]]]</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>bd <span class="ot">&lt;-</span> vegan<span class="sc">::</span><span class="fu">betadisper</span>(dist_bc, <span class="at">group =</span> meta_df<span class="sc">$</span>body_site)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>bd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Homogeneity of multivariate dispersions

Call: vegan::betadisper(d = dist_bc, group = meta_df$body_site)

No. of Positive Eigenvalues: 29
No. of Negative Eigenvalues: 4

Average distance to median:
       gut  left palm right palm     tongue 
    0.3950     0.4991     0.5487     0.3160 

Eigenvalues for PCoA axes:
(Showing 8 of 33 eigenvalues)
 PCoA1  PCoA2  PCoA3  PCoA4  PCoA5  PCoA6  PCoA7  PCoA8 
3.8480 2.6660 1.1788 0.8376 0.6125 0.5090 0.4639 0.4153 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>vegan<span class="sc">::</span><span class="fu">permutest</span>(bd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Permutation test for homogeneity of multivariate dispersions
Permutation: free
Number of permutations: 999

Response: Distances
          Df  Sum Sq  Mean Sq      F N.Perm Pr(&gt;F)    
Groups     3 0.28883 0.096278 9.0096    999  0.001 ***
Residuals 30 0.32059 0.010686                         
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cdi-message">
<p>If dispersion differs strongly across groups, PERMANOVA can appear significant even without true centroid separation.</p>
<p>Interpretation should report both results.</p>
</div>
<hr>
</section>
<section id="takeaway" class="level2">
<h2 class="anchored" data-anchor-id="takeaway">Takeaway</h2>
<ul>
<li>Ordination summarizes dissimilarity, not biology.</li>
<li>The distance metric and preprocessing choices define the geometry.</li>
<li>Visual separation is descriptive. Statistical tests support interpretation.</li>
<li>Always check dispersion when using PERMANOVA.</li>
</ul>
<!-- :::next
Next → [Heatmaps and Patterns](07-heatmaps-and-patterns.qmd)
::: -->


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./05-diversity-analysis.html" class="pagination-link" aria-label="Diversity Analysis">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">Diversity Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./07-heatmaps-and-patterns.html" class="pagination-link" aria-label="Heatmaps and Patterns">
        <span class="nav-page-text"><span class="chapter-title">Heatmaps and Patterns</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>